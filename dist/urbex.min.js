/**
    * https://github.com/orison-networks/urbex#readme
    * (c) 2022 Orison Networks
    * @license MIT
    */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("http"),require("https"),require("zlib"),require("util")):"function"==typeof define&&define.amd?define(["http","https","zlib","util"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).urbex=e(t.http,t.https,t.zlib,t.util)}(this,(function(t,e,n,r){"use strict";const o=new class{constructor(){this.o=this.detectContext()}detectContext(){if("undefined"!=typeof window&&void 0!==window.document)return"browser";if("undefined"!=typeof process&&process.versions&&process.versions.node)return"node";throw new Error("Unable to detect environment context.")}nodeStrictCheck(){if(this.isBrowser)throw new Error("This method is not available in the browser environment.")}get process(){return this.isNode?process:{}}get context(){return this.o}get isBrowser(){return"browser"===this.context}get isNode(){return"node"===this.context}get isDevelopment(){return this.nodeStrictCheck(),"development"===process.env.NODE_ENV}get isProduction(){return this.nodeStrictCheck(),"production"===process.env.NODE_ENV}};
/**
        * https://github.com/itsmichaelbtw/cache-clock#readme
        * (c) 2022 Michael Cizek
        * @license MIT
        */function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function a(t){return void 0===t}function l(t){return"object"===i(t)&&null!==t&&!Array.isArray(t)}function f(t){return"number"==typeof t&&!isNaN(t)}function h(t){return"function"==typeof t}function d(t){return t<0}function p(t){return Math.abs(t)}function v(t,e){return Object.assign({},t,e)}var m="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"!=typeof process&&process.versions&&process.versions.node?"node":"unknown",w={red:"[31m",yellow:"[33m",green:"[32m",lightblue:"[36m"};function y(t,e){if(y.DEBUG){var n="".concat(w[e]).concat("[CACHE-CLOCK] ").concat(t).concat("[0m");console.log(n)}}y.DEBUG=!1;var b,g=function(){try{return Date}catch(t){return Date}}(),T={maxItems:1e3,ttl:1/0,interval:15e3,debug:!1,autoStart:!0,overwrite:!1,resetTimeoutOnAccess:!1};function x(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;if(!l(t))return y("Invalid options passed to cache clock, using defaults.","yellow"),e;var n=v(e,t);return f(n.maxItems)&&d(n.maxItems)?n.maxItems=p(n.maxItems):f(n.maxItems)||(n.maxItems=e.maxItems),f(n.ttl)&&d(n.ttl)?n.ttl=p(n.ttl):f(n.maxItems)||(n.ttl=e.ttl),f(n.interval)&&d(n.interval)?n.interval=p(n.interval):f(n.interval)||(n.interval=e.interval),n.onExpire&&!h(n.onExpire)&&(n.onExpire=void 0),0===n.maxItems&&(n.maxItems=1),n}function E(t,e){return e?t:("string"!=typeof(n=a(r=t)?"":function(t){return"string"==typeof t}(r)?r:JSON.stringify(r))&&(n=JSON.stringify(n)),n.split("").reduce((function(t,e){return 0|(t<<5)-t+24*t+e.charCodeAt(0)}),0).toString(32));var n,r}b=Symbol.iterator;var j=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),u(this,"$birth",void 0),u(this,"$cache",void 0),u(this,"$clock",void 0),u(this,"$options",void 0),this.$birth=g.now(),this.$cache=new Map,this.configure(e),this.options.autoStart&&this.start()}var e,n,r;return e=t,n=[{key:"prune",value:function(){this.stop();var t,e=g.now(),n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){u=!0,i=t},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw i}}}}(this);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.e<=e){var o=this.del(r.k,!0);this.options.onExpire&&o&&this.options.onExpire(o)}}}catch(t){n.e(t)}finally{n.f()}this.start()}},{key:"age",get:function(){return g.now()-this.$birth}},{key:"size",get:function(){return this.$cache.size}},{key:"options",get:function(){return this.$options}},{key:"isRunning",get:function(){return!!this.$clock}},{key:"configure",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$options=x(t,this.options||T),y.DEBUG=this.options.debug,this.options.interval<T.interval&&y("A cache clock interval less than 15 seconds is not recommended.","yellow")}},{key:"start",value:function(){var t,e;this.options.interval!==1/0&&0!==this.options.interval?this.$clock?y("Cache clock is already running. Unable to start.","red"):this.$clock=(t=this.prune.bind(this),e=this.options.interval,("node"===m?global.setTimeout:window.setTimeout).call(null,t,e)):y("Disabling the clock due to an unsupported interval.","yellow")}},{key:"stop",value:function(){this.$clock?(clearTimeout(this.$clock),this.$clock=null):y("Cache clock is not running. Unable to stop.","red")}},{key:"set",value:function(t,e,n){var r=E(t,!1),o=x(n,this.options),i=o.ttl,s=o.overwrite,u={k:r,v:e,t:i,e:g.now()+i},c=this.get(r,!0);if(c){if(!s)return y('Unable to set cache item "'.concat(r,'". The item already exists.'),"red"),c;y('Overwriting existing cache entry for key "'.concat(r,'".'),"yellow"),this.del(r,!0)}return this.size>=this.options.maxItems&&(y("The cache is full, removing oldest item.","yellow"),this.del(this.$cache.keys().next().value,!0)),this.$cache.set(r,u),u}},{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=E(t,e),r=this.$cache.get(n);if(!a(r)){var o=g.now();return r.e<o?(y("Cache item ".concat(t," has expired."),"red"),void this.del(n,!0)):(this.options.resetTimeoutOnAccess&&(r.e=o+r.t),r)}}},{key:"del",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=E(t,e),r=this.$cache.get(n);if(!a(r))return y("Deleting cache item ".concat(t,"."),"green"),this.$cache.delete(n),r}},{key:"has",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=E(t,e),r=this.get(n,!0);return!a(r)}},{key:"clear",value:function(){this.$cache.clear()}},{key:"getCacheKey",value:function(t){return E(t,!1)}},{key:"toJSON",value:function(){return Array.from(this.$cache.values())}},{key:b,value:function(){return this.$cache.values()}}],r=[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new t(e)}}],n&&s(e.prototype,n),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();class k extends Error{static create(t){const e=new this;return e.config=t,e}static createErrorInstance(t){const e=t.create.call(t,this.config);return e.request=this.request,e}static isInstance(t){return t instanceof k}}class P extends k{constructor(){super(),this.name="TimeoutError",this.message="The request timed out."}set timeout(t){this.message=`Timeout of ${t}ms exceeded`}}class O extends k{constructor(){super(),this.name="NetworkError",this.message="Failed to request the resource."}}function S(t,e,n){var r;const i=o.isNode?n.response.statusCode:n.response.status;if(this.config.resolveStatus(this.config,i))return t(n);const s=k.createErrorInstance.call(this,k),u=`Request failed with status code ${i}`;return s.message=o.isNode?n.response.statusMessage:null!==(r=n.response.statusText)&&void 0!==r?r:u,s.request=this.request,s.status=i,s.response=n.response,e(s)}function C(t,e){return t.hasOwnProperty.call(t,e)}function q(t){return void 0===t}function A(t){return Array.isArray(t)}function $(t){return"object"==typeof t&&null!==t&&!A(t)}function U(t){return"string"==typeof t}function L(t){return"function"==typeof t}function N(t){return A(t)?0===t.length:$(t)?0===Object.keys(t).length:!t}function I(t){return String(t).toUpperCase()}function R(t){if(A(t))return t.map(R);if($(t)&&t.constructor===Object){const e={};for(const n in t)C(t,n)&&(e[n]=R(t[n]));return e}return t}function D(t,e){return Object.assign({},t,e)}function M(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.reduce(((t,e)=>{if(A(e))return t.concat(e);for(const n in e)A(t[n])&&A(e[n])?t[n]=t[n].concat(e[n]):$(t[n])&&$(e[n])?t[n]=M(t[n],e[n]):t[n]=e[n];return t}),{})}function z(t,e){if(!q(t))if(A(t))t.forEach((function(n,r){e.call(null,r,n,t)}));else for(const n in t)e.call(null,n,t[n],t)}function H(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(t){const r=e.exec(t);if(A(r)&&!N(r))return r[n]}return r}function J(t,e,n){return t.replace(e,n)}function B(t,e){return F(e)?"":e.startsWith(t)?e:`${t}${e}`}function F(t){return null==t}function G(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return n.filter((t=>!N(t))).join(t)}function K(t){return t.reduce(((t,e)=>{const n=e.split(".");if(1===n.length)t[e]=null;else{const[e,...r]=n;t[e]||(t[e]={});const o=K(r);t[e]=D(t[e],o)}return t}),{})}class X{getAgentFromProtocol(n){return"https"===n?e:t}handleDataProtocolRequest(t){return new Promise(((t,e)=>{t({data:null,request:null,response:null})}))}async send(t){return new Promise(((e,n)=>{var r;const o=this.getAgentFromProtocol(t.url.protocol);if("data"===t.url.protocol)return this.handleDataProtocolRequest(t);t.headers.has("Accept-Encoding")||t.headers.set({"Accept-Encoding":"gzip, deflate, br"}),t.url.params&&!U(t.url.params)?t.url.params=t.url.params.toString():t.url.params="";const i={protocol:(":",s=t.url.protocol,F(s)?"":s.endsWith(":")?s:`${s}:`),href:t.url.href,hostname:t.url.hostname,path:G("",t.url.endpoint,t.url.params),headers:t.headers.get(),timeout:t.timeout};var s;if(t.url.port){const e=parseInt(t.url.port.toString());isNaN(e)||(i.port=e)}const u=o.request(i);function c(r){return S.call({config:t,request:u},e,n,r)}function a(e){return k.createErrorInstance.call({config:t,request:u},e)}function l(t){this.push(t)}function f(t){if(t instanceof k)return n(t);const e=a(O);return e.message=t.message,n(e)}function h(){this.complete||this.aborted||this.destroyed||(this.destroy(),u.destroy())}function d(t){c({data:Buffer.concat(this),request:u,response:t}),h.call(t)}u.on("response",(function(e){if(e.destroyed||u.destroyed)return;if("stream"===t.responseType)return c({data:e,request:u,response:e});const n=[];e.on("data",(t=>{l.call(n,t)})),e.on("error",(t=>{f.call(e,t)})),e.on("close",(()=>{h.call(e)})),e.on("end",(()=>{d.call(n,e)}))})),u.on("error",(t=>{f.call(u,t)})),t.timeout&&u.on("timeout",(function(){const e=a(P);e.timeout=t.timeout,u.destroy(e)})),u.end(null!==(r=t.data)&&void 0!==r?r:void 0)}))}}const Q={br:L(null==n?void 0:n.brotliDecompress)?r.promisify(n.brotliDecompress):null,gzip:L(null==n?void 0:n.gunzip)?r.promisify(n.gunzip):null,deflate:L(null==n?void 0:n.inflate)?r.promisify(n.inflate):null,compress:L(null==n?void 0:n.createUnzip)?r.promisify(n.createUnzip):null},V=["arraybuffer","blob","document","json","text"];class W{send(t){return new Promise(((e,n)=>{const r=new XMLHttpRequest;function o(t,e){for(const{event:n,listener:o}of t)r[e](n,o)}function i(e){return k.createErrorInstance.call({config:t,request:r},e)}r.open(I(t.method),t.url.href,!0),V.includes(t.responseType)&&"json"!==t.responseType&&(r.responseType=t.responseType),q(t.data)&&t.headers.delete("Content-Type"),z(t.headers.get(),r.setRequestHeader.bind(r)),t.timeout&&(r.timeout=t.timeout);const s=[{event:"timeout",listener:function(e){const r=i(P);r.timeout=t.timeout,n(r),o(s,"removeEventListener")}},{event:"abort",listener:function(t){const e=i(k);e.message="The request was aborted.",n(e),o(s,"removeEventListener")}},{event:"error",listener:function(t){const e=i(O);n(e),o(s,"removeEventListener")}},{event:"load",listener:function(i){var u;u={data:"document"===r.responseType?r.responseXML:r.responseType&&"text"!==r.responseType?r.response:r.responseText,request:r,response:{status:r.status,statusText:r.statusText,headers:r.getAllResponseHeaders()}},S.call({config:t,request:r},e,n,u),o(s,"removeEventListener")}}];o(s,"addEventListener"),r.onreadystatechange=function(){},r.send(t.data)}))}}function Y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}K(["br","gzip","deflate","compress"]);class Z{constructor(t){Y(this,"$executor",null),this.$executor=t}static async process(t,e){for(const n of e){const e=await n.execute(t);if(!$(e)||F(e))throw new Error("Urbex expected a valid configuration to be returned from a pipeline.");t=t}}execute(t){return this.$executor(t)}}const _={"Content-Type":"application/json"},tt=D(_,{"User-Agent":`UrbexClient (Node.js ${o.process.version}; ${o.process.platform})`}),et=["POST","PUT","PATCH"],nt=K(["endpoint","hostname","href","origin","params","port","protocol","urlMount"]),rt={request:[],response:[]},ot={url:D(nt,{protocol:"http",urlMount:"/api"}),timeout:0,method:"GET",headers:null,data:null,cache:{},pipelines:rt,maxContentLength:1/0,responseType:"json",responseEncoding:"utf8",resolveStatus:(t,e)=>e>=200&&e<300},it=K(["status","statusText","headers","data","config","request","response","duration","timestamp","cache.key","cache.hit","cache.pulled","cache.stored"]);function st(t){return J(t,"\n","")}function ut(t){if(t){const n=function(t){return t.split("-").map((t=>{const e=st(t).trim();if(e)return function(t){return 1===(t=String(t)).length?t.toUpperCase():t.charAt(0).toUpperCase()+t.slice(1)}(e)})).join("-")}((e=t,String(e).toLowerCase())).trim();return st(n)}var e}function ct(t){if(!q(t)&&!1!==t&&null!==t)return A(t)?t.join(", "):$(t)?JSON.stringify(t):st(t.toString().trim())}class at{constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Y(this,"$headers",{}),e&&this.set(this.defaults,!1),$(t)&&!N(t)&&this.set(t,e)}static construct(){return new at(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}static parse(t){if(F(t)||!U(t))return{};const e={};return z(t.split("\r"),((t,n)=>{const[r,o]=n.toString().split(":"),i=ut(r),s=ct(o);i&&s&&(e[i]=s)})),e}get defaults(){return o.isNode?tt:_}set(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!$(t))return n="Attempted to set headers with a non-object value: "+typeof t,console.error(`[urbex] ${n}`),t;var n;const r=this.normalize(t),o=e?D(this.$headers,r):r;return this.$headers=o}get(){return this.$headers}has(t){return C(this.$headers,ut(t))}delete(t){z(this.$headers,(e=>{e.toLowerCase()===t.toLowerCase()&&delete this.$headers[e]}))}clear(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$headers={},t||this.set(this.defaults,!1)}normalize(t){return F(t)||!$(t)?{}:function(t){const e={};return z(t,((t,n)=>{if(q(t)||q(n))return;const r=ut(t),o=ct(n);r&&o&&(e[r]=o)})),e}(t)}}class lt{constructor(){this.register(o.context),this.$cache=new j({autoStart:!1,debug:!1})}register(t){if("browser"!==t){if("node"!==t)throw new Error(`Urbex expected a valid context to register a request api, but got ${t}.`);this.$api=new X}else this.$api=new W}async dispatchRequest(t){try{const e=R(t),n=await async function(t){const e=Date.now(),n=(new Date).toISOString(),r=R(it);return N(t.pipelines.request)||await Z.process(t,t.pipelines.request),async function(i){let s=M(r,{data:i.data,config:t,request:i.request||{},response:i.response||{},timestamp:n,responseType:t.responseType,cache:i.cache||{}});if(s.cache&&s.cache.hit){const t=200,e="Pulled from internal cache";o.isNode?(s.response.statusCode=t,s.response.statusMessage=e):(s.response.status=t,s.response.statusText=e)}if(s.response)if(s.headers=s.response.headers,o.isNode)s.status=s.response.statusCode,s.statusText=s.response.statusMessage;else{const t=at.parse(s.headers);s.headers=t,s.status=s.response.status,s.statusText=s.response.statusText}N(t.pipelines.response)||await Z.process(s,t.pipelines.response);const u=Date.now()-e;return s.duration=u,Promise.resolve(s)}}(e),r=e.cache&&e.cache.enabled;if(r){const t=this.$cache.getCacheKey(e.url.href),r=this.$cache.get(t,!0);if(r){const e=await n({data:r.v,request:null,response:null,cache:{key:t,pulled:!0,hit:!0,stored:!1}});return Promise.resolve(e)}}const i=await this.$api.send(e),s=await n(i);return r&&!q(s.data)&&(this.$cache.set(e.url.href,s.data),s.cache.key=this.$cache.getCacheKey(e.url.href),s.cache.stored=!0),s.cache.hit=r,Promise.resolve(s)}catch(e){if(k.isInstance(e))return Promise.reject(e);const n=k.create(t);return n.message=e.message,Promise.reject(n)}}}const ft=["stream","raw"],ht=new Z((t=>(et.includes(I(t.method))?t.headers.set({"Content-Type":"application/x-www-form-urlencoded"}):t.data=void 0,Promise.resolve(t)))),dt=new Z((async t=>{const{responseType:e,maxContentLength:n}=t.config;if(ft.includes(e)||t.cache.pulled)return Promise.resolve(t);const r=t.headers["content-encoding"];if(Buffer.isBuffer(t.data)&&t.data.length){if(r){const e=Q[r];if(e){const r=await e(t.data);if((n>-1||n!==1/0)&&r.length>n)throw new Error(`Content length of ${r.length} exceeds the maxContentLength of ${n}`);t.data=r}}}else t.data=null;return Promise.resolve(t)})),pt=new Z((t=>{const{responseType:e,responseEncoding:n}=t.config;if(ft.includes(e)||"arraybuffer"===e||t.cache.pulled)return Promise.resolve(t);if(t.data){let r=t.data;o.isNode&&(r=t.data.toString(n)),t.data="json"===e?function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{return JSON.parse(t)}catch(n){return e?t:null}}(r,!0):r}return Promise.resolve(t)})),vt=/^(?:([a-z]+):\/\/)?([^:\/\n]+)/i,mt=["PUT","POST","PATCH","OPTIONS","HEAD","GET","DELETE"];function wt(t){try{return new URL(t),!0}catch(t){return!1}}function yt(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=new URL(t),r=J(n.protocol,":",""),o=n.port?parseInt(n.port):"",i=J(n.pathname,e,"");return{href:n.href,origin:n.origin,protocol:r,hostname:n.hostname,port:o,endpoint:i,params:n.search,urlMount:e}}function bt(t){let e="{protocol+://}{hostname}{:+port}{urlMount}{endpoint}{?+params}";return F(t)||N(t)||!$(t)?"":(t.params&&(t.params=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"string";if(F(t))return null;try{const n=new URLSearchParams(t);if("object"===e){const t={};return n.forEach(((e,n)=>{t[n]=e})),t}return n.toString()}catch(t){return null}}(t.params)),z(t,((t,n)=>{const r=new RegExp(`[{][^{{]*\\b${t}\\b[^{}]*[}]`,"gi");if(F(n)||N(n))e=J(e,r,"");else{const o=H(e,r,0,""),i=J(o,t,n.toString()).replace(/\+/g,"").replace(/^\{/,"").replace(/\}$/,"");e=J(e,o,i)}})),e)}function gt(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(U(t)){if(wt(t))return yt(t);if(e)return{endpoint:B("/",t)};throw new Error("An invalid URL was provided. A valid URL string in the format of <scheme>://<hostname> must be passed when using `urbex.configure()`.")}if($(t)){const e=H(t.protocol,vt,0,"http"),n=J(t.hostname,new RegExp(`^${e}://`,"gi"),""),r=B("/",t.endpoint),o=B("/",t.urlMount);return yt(bt(D(t,{protocol:e,hostname:n,endpoint:r,urlMount:o})),o)}throw new Error("Unable to parse the provided URI. Must be either a string or an object.")}function Tt(){const t=D(nt,{protocol:"https",urlMount:"/api"});if(o.isBrowser){const{protocol:e,hostname:n,port:r}=window.location;Object.assign(t,{protocol:e.replace(":",""),hostname:n,port:r})}else o.isNode&&Object.assign(t,{protocol:"http",hostname:"localhost",port:3e3});return t}class xt{constructor(t){this.setup(),$(t)&&!N(t)&&this.set(this.createConfigurationObject(t,!0))}setup(){const t=gt(Tt()),e=R(rt);e.request.push(ht),e.response.push(pt),o.isNode&&e.response.unshift(dt);const n=M(ot,{url:t,headers:new at,pipelines:e});this.set(n)}defaultConfig(){return D(ot,{url:gt(Tt()),headers:new at})}createConfigurationObject(t,e){const n=this.parseIncomingConfig(t,e);return this.merge(n)}parseIncomingConfig(t,e){var n,r,o,i;if(F(t)||!$(t))throw new Error("The configuration must be an object with valid properties.");const s=A(u=t)?u.slice():$(u)?Object.assign({},u):u;var u;if(C(s,"url")){const t=this.get().url;$(s.url)&&(s.url=D(t,s.url)),e&&s.url.toString().startsWith("/")&&(s.url=D(t,{endpoint:s.url}));const n=gt(s.url,e);s.url=n}if(C(s,"method")){const t=I(s.method);if(!mt.includes(t))throw new Error(`The method ${t} is not a valid HTTP method.`);s.method=t}const c=parseInt(null!==(n=null===(r=s.timeout)||void 0===r?void 0:r.toString())&&void 0!==n?n:ot.timeout.toString());isNaN(c)&&(s.timeout=ot.timeout);const a=parseInt(null!==(o=null===(i=s.maxContentLength)||void 0===i?void 0:i.toString())&&void 0!==o?o:ot.maxContentLength.toString());isNaN(a)&&(s.maxContentLength=ot.maxContentLength),L(t.resolveStatus)||(t.resolveStatus=ot.resolveStatus);const l=at.construct(s.headers,!0);return delete s.headers,D(s,{headers:l})}set(t){return this.$config=t,t}merge(t){var e,n;if(F(t)||!$(t))return this.get();const r=this.get(),o=null!==(e=null===(n=t.headers)||void 0===n?void 0:n.get())&&void 0!==e?e:{},i=D(r.headers,o);return delete t.headers,D(M(r,t),{headers:at.construct(i)})}get(){return this.$config}reset(){this.setup()}}function Et(t,e,n){if(F(e))throw new Error("Attempted to call a HTTP method without providing a URL. If you want to use the default URL, use `urbex.send` instead.");return D(n,{url:e,method:t})}class jt extends lt{constructor(t){super(),this.$config=new xt,$(t)&&!N(t)&&this.configure(t)}static create(t){return new jt(t)}get config(){return this.$config.get()}get cache(){return this.$cache}configure(t){const e=this.$config.createConfigurationObject(t,!1);this.$config.set(e);const n=this.$cache;function r(){n&&(n.clear(),n.isRunning&&n.stop())}N(e.cache)?r():(n.configure(e.cache),e.cache.enabled?n&&n.isRunning||n.start():!1===e.cache.enabled&&r())}send(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this.$config.parseIncomingConfig(t,!0),n=this.$config.merge(e);return this.dispatchRequest(n)}injectPipeline(){}ejectPipeline(){}subscribe(){}unsubscribe(){}reset(){this.$cache&&(this.$cache.clear(),this.$cache.isRunning&&this.$cache.stop()),this.$config.reset()}}function kt(t){return t instanceof jt}z(["delete","get","head","options"],((t,e)=>{jt.prototype[e]=function(t,n){return this.send(Et(I(e),t,n))}})),z(["post","put","patch"],((t,e)=>{jt.prototype[e]=function(t,n,r){const o=q(n)?n:$(r)?D(r,{data:n}):{data:n};return this.send(Et(I(e),t,o))}}));const Pt=function(){const t=jt.create();return t.isolateClient=jt.create,t.environment=o,t.isUrbexClient=kt,t.Client=jt,t}();return Pt.PipelineExecutor=Z,Pt}));
//# sourceMappingURL=urbex.min.js.map
