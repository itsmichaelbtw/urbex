/**
    * https://github.com/orison-networks/urbex#readme
    * (c) 2022 Orison Networks
    * @license MIT
    */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("http"),require("https"),require("zlib"),require("util")):"function"==typeof define&&define.amd?define(["http","https","zlib","util"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).urbex=e(t.http,t.https,t.zlib,t.util)}(this,(function(t,e,n,r){"use strict";function s(t,e){return t.hasOwnProperty.call(t,e)}function i(t){return void 0===t}function o(t){return Array.isArray(t)}function c(t){return"object"==typeof t&&null!==t&&!o(t)}function u(t){return"string"==typeof t}function h(t){return"function"==typeof t}function a(t){return"number"==typeof t}function f(t){return o(t)?0===t.length:c(t)?0===Object.keys(t).length:!t}function l(t){return String(t).toUpperCase()}function d(t){return String(t).toLowerCase()}function p(t){return o(t)?t.slice():c(t)?Object.assign({},t):t}function w(t){if(o(t))return t.map(w);if(c(t)&&t.constructor===Object){const e={};for(const n in t)s(t,n)&&(e[n]=w(t[n]));return e}return t}function v(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n){const n=y(e).reduce(((t,n)=>(e[n]&&(t[n]=e[n]),t)),{});return Object.assign({},t,n)}return Object.assign({},t,e)}function m(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.reduce(((t,e)=>{if(o(e))return t.concat(e);for(const n in e)o(t[n])&&o(e[n])?t[n]=t[n].concat(e[n]):c(t[n])&&c(e[n])?t[n]=m(t[n],e[n]):t[n]=e[n];return t}),{})}function y(t){return Object.keys(t)}function g(t,e){if(!i(t))if(o(t))t.forEach((function(n,r){e.call(null,r,n,t)}));else for(const n in t)e.call(null,n,t[n],t)}function b(t,e){return P(e)?"":e.startsWith(t)?e:`${t}${e}`}function E(t,e){return P(e)?"":e.endsWith(t)?e:`${e}${t}`}function P(t){return null==t}function x(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return n.filter((t=>!f(t))).join(t)}function T(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t.reduce(((t,n)=>{const r=n.split(".");if(1===r.length)t[n]=e;else{const[e,...n]=r;t[e]||(t[e]={});const s=T(n);t[e]=v(t[e],s)}return t}),{})}const S=["POST","PUT","PATCH"],k=["href","origin","protocol","username","password","hostname","port","pathname","search","searchParams","hash"];T(k,"");const j={request:[],response:[]},O={url:null,timeout:0,method:"GET",headers:null,data:null,cache:{},pipelines:j,maxContentLength:1/0,responseType:"json",responseEncoding:"utf8",resolveStatus:(t,e)=>e>=200&&e<300},$=T(["status","statusText","headers","data","config","request","response","duration","timestamp","cache.key","cache.hit","cache.pulled","cache.stored"]),A=["PUT","POST","PATCH","OPTIONS","HEAD","GET","DELETE"],C=/^(?:([^:\/?#]+):)?(?:[\/\/]+((?:([^@\/\n]+)@)?((?:[0-9]{1,3}\.){3}[0-9]{1,3}|\[[0-9a-f:]+\]|[^#:\/?\n]+)(?::(\d*))?))?(?:[\/]*([^?#]*))(?:[\?]*([^#]*))?(?:[\#]*(.*))?/i,U=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/,L=/^(\[[0-9a-f:]+\])$/i,q=/^([^:]+)(?:\:([^:].+))?/;function I(t){return t.replace(/%20/g,"")}function R(t){return t?a(t)||!t.startsWith(":")?`:${t}`:t:""}function N(t,e){if(!t&&e)throw new Error("Cannot set password without username.");return t?e?x(":",t,e):t:""}function z(t,e){return E(e||"http"===t||"https"===t?"://":":",t)}function D(t){return t.replace(/:\/\/$/,"").replace(/:$/,"")}function H(t){if(!t||!u(t)&&!c(t)&&!o(t))return{search:"",searchParams:null};if(u(t))return{search:b("?",I(t)),searchParams:new URLSearchParams(t)};const e=new URLSearchParams;return g(t,((n,r)=>{if(r)if(o(r)){const t=r;e.append(t[0],t[1])}else c(t)&&e.append(n,r)})),{search:b("?",e.toString()),searchParams:e}}class J{constructor(t){if(t&&!u(t)&&!c(t))throw new TypeError("Invalid input. Must be a string or an object.");this.$component=T(k,""),this.$component.searchParams=new URLSearchParams,u(t)&&t?this.$component=this.parse(t):!c(t)||f(t)||(t.href?this.$component=this.parse(t.href):this.serialize(t))}sync(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"all";const r=this.$component.href,s=this.$component.origin;t&&("all"!==n&&"href"!==n||(this.$component.href=r.replace(t,e)),"all"!==n&&"origin"!==n||(this.$component.origin=s.replace(t,e)))}syncAuth(t,e,n){if(!e)throw new Error("Cannot set password without username.");let[r,s]=t.split("://");r=z(r,!!s);const i=x("",N(e,n),"@");this.$component.href=x("",r,i,s)}match(t){return C.exec(t)}parseProtocol(t){if(!t){const t=this.$component.protocol;return void(this.$component.protocol=t||"http")}const e=d(I(t=D(t)));this.$component.protocol=e}parseAuth(t){if(!t)return;const e=q.exec(t);if(!e||!e.length)throw new Error("Invalid auth format. Expected <username>:<password>");{const t=e[1],n=e[2];if(!t)throw new Error("Expected username in auth.");this.$component.username=t,this.$component.password=n||""}}parseHostname(t){t&&(t=U.test(t)?function(t){const e=U.exec(t);if(e){const t=e.slice(1).map((t=>parseInt(t,10)));if(t.every((t=>t<=255)))return t.join(".")}throw new Error("Invalid IPv4 address.")}(t):L.test(t)?function(t){const e=L.exec(t);if(e)return e[1];throw new Error("Invalid IPv6 address.")}(t):d(t),this.$component.hostname=I(t))}parsePort(t){if(!t)return void(this.$component.port="");const e=a(t)?t:parseInt(t,10);if(isNaN(e)||e<0||e>65535)throw new Error("Port must be between 0 and 65535.");this.$component.port=e}parseOrigin(t){const e=z(this.$component.protocol,!!this.$component.hostname);t&&this.$component.hostname?this.$component.origin=b(e,t):this.$component.origin="null";const n=N(this.$component.username,this.$component.password);if(n&&this.$component.origin.includes(n)){const t=x("",n,"@");this.$component.origin=this.$component.origin.replace(t,"")}}parsePathname(t){t&&(this.$component.hostname?this.$component.pathname=b("/",t):this.$component.pathname=t)}parseParams(t){if(!t)return;const e=H(t);e&&(this.$component.search=b("?",e.search),this.$component.searchParams=new URLSearchParams(e.searchParams))}parseHash(t){t&&(this.$component.hash=b("#",t))}parse(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!u(t)||f(t))throw new Error("Invalid URL.");const n=T(k,"");n.searchParams=new URLSearchParams,this.$component=e?n:v(n,this.$component),t=(t=(t=t.trim()).replace(/\s/g,"%20")).replace(/\\/g,"/");const r=this.match(t);if(null===r||0===r.length)throw new Error("Invalid URL.");const[s,i,o,c,h,a,l,d,p]=r;return this.parseProtocol(i),this.parseAuth(c),this.parseHostname(h),this.parsePort(a),this.parsePathname(l),this.parseParams(d),this.parseHash(p),this.parseOrigin(o),this.$component.href=s,this.$component}serialize(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=v(T(k,""),t),r=[],s=N(n.username,n.password);if(n.origin){const[t,e,i,o,c,u]=this.match(n.origin);if(r.push(z(e,!!c)),s&&!n.origin.includes(s)){const t=i.replace(`${o}@`,"");r.push(s),r.push("@"),r.push(t)}else o&&(r.push(o),r.push("@")),r.push(c),u&&r.push(R(u))}else{if(!n.protocol)throw new Error("Expected a protocol when serializing a URL.");if(("http"===n.protocol||"https"===n.protocol)&&!n.hostname)throw new Error("Expected a hostname when serializing a URL with an HTTP protocol.");r.push(z(n.protocol,!!n.hostname)),s&&(r.push(s),r.push("@")),n.hostname&&r.push(n.hostname),r.push(R(n.port))}r.push(b("/",n.pathname));const i=n.search||n.searchParams||"";if(i)if(i instanceof URLSearchParams){const t=i.toString();t&&r.push(b("?",t))}else{const{search:t}=H(i.toString());r.push(b("?",t))}n.hash&&r.push(b("#",n.hash));const o=r.filter((t=>t&&"/"!==t)).join("");try{return this.parse(o,e).href}catch(t){throw new Error("Attempted to serialize an invalid URL.")}}}class M extends J{constructor(t){super(t)}static parse(t){return new this(t)}static serialize(t){return(new this).serialize(t)}set(t){return this.$component=v(this.$component,t),t.searchParams instanceof URLSearchParams&&(this.$component.search=t.searchParams.toString(),this.$component.searchParams=t.searchParams),this}get href(){return this.$component.href}set href(t){this.parse(t)}get origin(){return this.$component.origin}set origin(t){const[e,n,r,s,i,o]=this.match(t);this.parseAuth(s);const c=v(this.$component,{href:"",origin:x("",z(n,!!i),r)});this.serialize(c)}get protocol(){return this.$component.protocol}set protocol(t){if(t===this.protocol)return;const e=z(this.protocol,!!this.hostname),n=z(D(t),!t.includes("data"));this.parseProtocol(t),this.sync(e,n)}get username(){return this.$component.username}set username(t){const e=this.username;if(t===this.username)return;const n=N(t,this.password);this.parseAuth(n),e?this.sync(e,t):this.origin&&this.syncAuth(this.origin,this.username,this.password)}get password(){return this.$component.password}set password(t){const e=this.password;if(t===e)return;const n=N(this.username,t);this.parseAuth(n),e?this.sync(e,t):this.origin&&this.syncAuth(this.origin,this.username,this.password)}get hostname(){return this.$component.hostname}set hostname(t){const e=this.hostname;t!==e&&(this.parseHostname(t),this.sync(e,this.hostname))}get port(){return this.$component.port}set port(t){const e=this.port.toString();if(t.toString()!==e)if(this.parsePort(t),e)this.sync(e,this.port.toString());else if(this.origin){const t=this.origin,e=x(":",t,this.port.toString());this.sync(t,e)}}get pathname(){return this.$component.pathname}set pathname(t){const e=this.pathname;if(t!==e)if(this.parsePathname(t),e)this.sync(e,this.pathname);else if(this.origin){const t=this.origin,e=x("",t,b("/",this.pathname));this.sync(t,e,"href")}}get search(){return H(this.$component.search).search}get searchParams(){return this.$component.searchParams}get hash(){return this.$component.hash}set hash(t){const e=this.hash;if(t!==e)if(this.parseHash(t),e)this.sync(e,this.hash,"href");else if(this.origin){const t=this.origin,e=x("",t,b("#",this.hash));this.sync(t,e,"href")}}setSearchParams(t){const e=this.search;if(t!==e)if(t instanceof URLSearchParams&&(t=t.toString()),this.parseParams(t),e)this.sync(e,this.search,"href");else if(this.origin){const t=this.origin,e=x("",t,b("?",this.search));this.sync(t,e,"href")}}toString(){return this.$component.href}toJSON(){return this.$component}}const B=new class{constructor(){this.i=this.detectContext()}detectContext(){if("undefined"!=typeof window&&void 0!==window.document)return"browser";if("undefined"!=typeof process&&process.versions&&process.versions.node)return"node";throw new Error("Unable to detect environment context.")}nodeStrictCheck(){if(this.isBrowser)throw new Error("This method is not available in the browser environment.")}get process(){return this.isNode?process:{}}get context(){return this.i}get isBrowser(){return"browser"===this.context}get isNode(){return"node"===this.context}get isDevelopment(){return this.nodeStrictCheck(),"development"===process.env.NODE_ENV}get isProduction(){return this.nodeStrictCheck(),"production"===process.env.NODE_ENV}getEnvironmentComponent(){if(this.isBrowser)return M.parse(window.location.href);{const t=process.env.PORT||"3000";return M.parse(`http://localhost:${t}`)}}};
/**
        * https://github.com/itsmichaelbtw/cache-clock#readme
        * (c) 2022 Michael Cizek
        * @license MIT
        */function F(t){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F(t)}function G(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function K(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Q(t){return void 0===t}function V(t){return"object"===F(t)&&null!==t&&!Array.isArray(t)}function W(t){return"number"==typeof t&&!isNaN(t)}function Y(t){return"function"==typeof t}function Z(t){return t<0}function _(t){return Math.abs(t)}function tt(t,e){return Object.assign({},t,e)}var et,nt="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"!=typeof process&&process.versions&&process.versions.node?"node":"unknown",rt={red:"[31m",yellow:"[33m",green:"[32m",lightblue:"[36m"};function st(t,e){if(st.DEBUG){var n="".concat(rt[e]).concat("[CACHE-CLOCK] ").concat(t).concat("[0m");console.log(n)}}st.DEBUG=!1;var it=Date,ot={maxItems:1e3,ttl:1/0,interval:15e3,debug:!1,autoStart:!0,overwrite:!1,resetTimeoutOnAccess:!1};function ct(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;if(!V(t))return st("Invalid options passed to cache clock, using defaults.","yellow"),e;var n=tt(e,t);return W(n.maxItems)&&Z(n.maxItems)?n.maxItems=_(n.maxItems):W(n.maxItems)||(n.maxItems=e.maxItems),W(n.ttl)&&Z(n.ttl)?n.ttl=_(n.ttl):W(n.maxItems)||(n.ttl=e.ttl),W(n.interval)&&Z(n.interval)?n.interval=_(n.interval):W(n.interval)||(n.interval=e.interval),n.onExpire&&!Y(n.onExpire)&&(n.onExpire=void 0),0===n.maxItems&&(n.maxItems=1),n}function ut(t,e){return e?t:("string"!=typeof(n=Q(r=t)?"":function(t){return"string"==typeof t}(r)?r:JSON.stringify(r))&&(n=JSON.stringify(n)),n.split("").reduce((function(t,e){return 0|(t<<5)-t+24*t+e.charCodeAt(0)}),0).toString(32));var n,r}var ht={hits:0,sets:0,misses:0,evictions:0,expired:0,deletes:0,overwrites:0,clears:0,lifecycles:0};et=Symbol.iterator;var at=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),K(this,"$birth",void 0),K(this,"$cache",void 0),K(this,"$clock",void 0),K(this,"$options",void 0),K(this,"$statistics",void 0),this.$birth=it.now(),this.$cache=new Map,this.configure(e),this.$statistics=Object.assign({},ht),this.options.autoStart&&this.start()}var e,n,r;return e=t,n=[{key:"prune",value:function(){this.stop();var t,e=it.now(),n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return X(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,s=function(){};return{s:s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){c=!0,i=t},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}(this);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.e<=e){var s=this.del(r.k,!0);this.options.onExpire&&s&&this.options.onExpire(s),this.$statistics.expired++}}}catch(t){n.e(t)}finally{n.f()}this.start()}},{key:"age",get:function(){return it.now()-this.$birth}},{key:"size",get:function(){return this.$cache.size}},{key:"options",get:function(){return this.$options}},{key:"stats",get:function(){return this.$statistics}},{key:"isRunning",get:function(){return!!this.$clock}},{key:"configure",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$options=ct(t,this.options||ot),st.DEBUG=this.options.debug,this.options.interval<ot.interval&&st("A cache clock interval less than 15 seconds is not recommended.","yellow")}},{key:"getCacheKey",value:function(t){return ut(t,!1)}},{key:"start",value:function(){var t,e;this.options.interval!==1/0&&0!==this.options.interval?this.$clock?st("Cache clock is already running. Unable to start.","red"):this.$clock=(t=this.prune.bind(this),e=this.options.interval,("node"===nt?global.setTimeout:window.setTimeout).call(null,t,e)):st("Disabling the clock due to an unsupported interval.","yellow")}},{key:"stop",value:function(){this.$clock?(clearTimeout(this.$clock),this.$clock=null,this.$statistics.lifecycles++):st("Cache clock is not running. Unable to stop.","red")}},{key:"set",value:function(t,e,n){var r=ut(t,!1),s=ct(n,this.options),i=s.ttl,o=s.overwrite,c={k:r,v:e,t:i,e:it.now()+i},u=this.get(r,!0);if(u){if(!o)return st('Unable to set cache item "'.concat(r,'". The item already exists.'),"red"),u;st('Overwriting existing cache entry for key "'.concat(r,'".'),"yellow"),this.del(r,!0),this.$statistics.overwrites++}return this.size>=this.options.maxItems&&(st("The cache is full, removing oldest item.","yellow"),this.del(this.$cache.keys().next().value,!0),this.$statistics.evictions++),this.$cache.set(r,c),this.$statistics.sets++,c}},{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=ut(t,e),r=this.$cache.get(n);if(this.$statistics.hits++,!Q(r)){var s=it.now();return r.e<s?(st("Cache item ".concat(t," has expired."),"red"),this.del(n,!0),void this.$statistics.expired++):(this.options.resetTimeoutOnAccess&&(r.e=s+r.t),r)}this.$statistics.misses++}},{key:"del",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=ut(t,e),r=this.$cache.get(n);if(!Q(r))return st("Deleting cache item ".concat(t,"."),"green"),this.$cache.delete(n),this.$statistics.deletes++,r}},{key:"has",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=ut(t,e),r=this.get(n,!0);return!Q(r)}},{key:"clear",value:function(){this.$cache.clear(),this.$statistics.clears++}},{key:"resetStats",value:function(){this.$statistics=Object.assign({},ht)}},{key:"toJSON",value:function(){return Array.from(this.$cache.values())}},{key:et,value:function(){return this.$cache.values()}}],r=[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new t(e)}}],n&&G(e.prototype,n),r&&G(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ft(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class lt extends Error{constructor(){super(...arguments),ft(this,"message","An error occurred while executing a request.")}static create(t){const e=new this;return e.config=t,e.name=this.name,e}static createErrorInstance(t){const e=t.create.call(t,this.config);return e.request=this.request,e}static createFromError(t){t instanceof Error||(t=new Error(t));const e=new this(t.message);var n,r;return t.stack&&(e.stack=(n=t.stack,r=this.name,n.replace(/^Error/,r))),e.name=this.name,lt.isInstance(t)&&(e.name=t.name),e}static isInstance(t){return t instanceof lt}}class dt extends lt{constructor(t){super(),this.name="TimeoutError",this.message=t||"The request timed out."}}class pt extends lt{constructor(t){super(),this.name="NetworkError",this.message=t||"Failed to request the resource."}}class wt extends lt{constructor(t){super(),this.name="PipelineError",this.message=t||"An error occurred while executing a pipeline."}}function vt(t,e,n){const r=B.isNode?n.response.statusCode:n.response.status;try{if(this.config.resolveStatus(this.config,r))return t(n);const s=lt.createErrorInstance.call(this,lt);return s.status=r,s.response=n.response,s.request=this.request,B.isNode?s.message=n.response.statusMessage:s.message=n.response.statusText,s.message||(s.message=`Request failed with status code ${r}`),e(s)}catch(t){const s=lt.createFromError.call(lt,t);return s.message=t.message,s.config=this.config,s.request=this.request,s.response=n.response,s.status=r,e(s)}}class mt{getAgentFromProtocol(n){return"https"===n?e:t}handleDataProtocolRequest(t){return new Promise(((t,e)=>{t({data:null,request:null,response:null})}))}async send(t){return new Promise(((e,n)=>{var r;const s=this.getAgentFromProtocol(t.url.protocol);if("data"===t.url.protocol)return this.handleDataProtocolRequest(t);t.headers.has("Accept-Encoding")||t.headers.set({"Accept-Encoding":"gzip, deflate, br"});const i={protocol:E(":",t.url.protocol),href:t.url.href,hostname:t.url.hostname,path:x("",t.url.pathname,t.url.search),headers:t.headers.get(),timeout:t.timeout};t.url.port&&(i.port=t.url.port);const o=s.request(i);function c(r){return vt.call({config:t,request:o},e,n,r)}function u(e,n){const r=lt.createFromError.call(e,n);return r.config=t,r.request=o,r}function h(t){this.push(t)}function a(t){if(t instanceof lt)return n(t);const e=u(pt,t);return n(e)}function f(){this.complete||this.aborted||this.destroyed||(this.destroy(),o.destroy())}function l(t){c({data:Buffer.concat(this),request:o,response:t}),f.call(t)}o.on("response",(function(e){if(e.destroyed||o.destroyed)return;if("stream"===t.responseType)return c({data:e,request:o,response:e});const n=[];e.on("data",(t=>{h.call(n,t)})),e.on("error",(t=>{a.call(e,t)})),e.on("close",(()=>{f.call(e)})),e.on("end",(()=>{l.call(n,e)}))})),o.on("error",(t=>{a.call(o,t)})),t.timeout&&o.on("timeout",(function(){const e=new Error(`Timeout of ${t.timeout}ms exceeded`),n=u(dt,e);o.destroy(n)})),o.end(null!==(r=t.data)&&void 0!==r?r:void 0)}))}}const yt={br:h(null==n?void 0:n.brotliDecompress)?r.promisify(n.brotliDecompress):null,gzip:h(null==n?void 0:n.gunzip)?r.promisify(n.gunzip):null,deflate:h(null==n?void 0:n.inflate)?r.promisify(n.inflate):null,compress:h(null==n?void 0:n.createUnzip)?r.promisify(n.createUnzip):null},gt=["arraybuffer","blob","document","json","text"];class bt{send(t){return new Promise(((e,n)=>{const r=new XMLHttpRequest;function s(t,e){for(const{event:n,listener:s}of t)r[e](n,s)}function o(e,n){const s=lt.createFromError.call(e,n);return s.config=t,s.request=r,s}r.open(l(t.method),t.url.href,!0),gt.includes(t.responseType)&&"json"!==t.responseType&&(r.responseType=t.responseType),i(t.data)&&t.headers.delete("Content-Type"),g(t.headers.get(),r.setRequestHeader.bind(r)),t.timeout&&(r.timeout=t.timeout);const c=[{event:"timeout",listener:function(e){const r=new Error(`Timeout of ${t.timeout}ms exceeded`),i=o(dt,r);n(i),s(c,"removeEventListener")}},{event:"abort",listener:function(t){const e=o(lt,new Error("Request was aborted"));e.message="The request was aborted.",n(e),s(c,"removeEventListener")}},{event:"error",listener:function(t){const e=o(pt,new Error("Network Error"));n(e),s(c,"removeEventListener")}},{event:"load",listener:function(i){var o;o={data:"document"===r.responseType?r.responseXML:r.responseType&&"text"!==r.responseType?r.response:r.responseText,request:r,response:{status:r.status,statusText:r.statusText,headers:r.getAllResponseHeaders()}},vt.call({config:t,request:r},e,n,o),s(c,"removeEventListener")}}];s(c,"addEventListener"),r.onreadystatechange=function(){},r.send(t.data)}))}}T(["br","gzip","deflate","compress"]);class Et{constructor(t){ft(this,"$executor",null),this.$executor=t}static async process(t,e){for(const n of e){if(!(n instanceof Et))throw new wt("Urbex expected a valid pipeline to be passed to the `process` method.");const e=await n.execute(t);if(!c(e))throw new wt("Urbex expected a valid configuration to be returned from a pipeline.");t=t}}async execute(t){return this.$executor(t)}}const Pt={"Content-Type":"application/json"},xt=v(Pt,{"User-Agent":`UrbexClient (Node.js ${B.process.version}; ${B.process.platform})`});function Tt(t){return function(t,e,n){return t.replace("\n","")}(t)}function St(t){if(t){const e=function(t){return t.split("-").map((t=>{const e=Tt(t).trim();if(e)return n=e,1===(n=String(n)).length?n.toUpperCase():n.charAt(0).toUpperCase()+n.slice(1);var n})).join("-")}(d(t)).trim();return Tt(e)}}function kt(t){if(!i(t)&&!1!==t&&null!==t)return o(t)?t.join(", "):c(t)?JSON.stringify(t):Tt(t.toString().trim())}class jt{constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];ft(this,"$headers",{}),e&&this.set(this.defaults,!1),c(t)&&!f(t)&&this.set(t,e)}static construct(){return new jt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}static parse(t){if(P(t)||!u(t))return{};const e={};return g(t.split("\r"),((t,n)=>{const[r,s]=n.toString().split(":"),i=St(r),o=kt(s);i&&o&&(e[i]=o)})),e}get defaults(){return B.isNode?xt:Pt}set(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!c(t))return n="Attempted to set headers with a non-object value: "+typeof t,console.error(`[urbex] ${n}`),t;var n;const r=this.normalize(t),s=e?v(this.$headers,r):r;return this.$headers=s}get(){return this.$headers}has(t){return s(this.$headers,St(t))}delete(t){g(this.$headers,(e=>{e.toLowerCase()===t.toLowerCase()&&delete this.$headers[e]}))}clear(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$headers={},t||this.set(this.defaults,!1)}normalize(t){return P(t)||!c(t)?{}:function(t){const e={};return g(t,((t,n)=>{if(i(t)||i(n))return;const r=St(t),s=kt(n);r&&s&&(e[r]=s)})),e}(t)}}class Ot{constructor(){this.register(B.context),this.$cache=new at({autoStart:!1,debug:!1})}register(t){if("browser"!==t){if("node"!==t)throw new Error(`Urbex expected a valid context to register a request api, but got ${t}.`);this.$api=new mt}else this.$api=new bt}async dispatchRequest(t){try{const e=t,n=await async function(t){const e=Date.now(),n=(new Date).toISOString(),r=w($);if(!f(t.pipelines.request))try{await Et.process(t,t.pipelines.request)}catch(e){const n=lt.createFromError.call(wt,e);return n.config=t,Promise.reject(n)}return async function(s){const i=m(r,{data:s.data,config:t,request:s.request||{},response:s.response||{},timestamp:n,responseType:t.responseType,cache:s.cache||{}});if(i.cache&&i.cache.hit){const t=200,e="Pulled from internal cache.";B.isNode?(i.response.statusCode=t,i.response.statusMessage=e):(i.response.status=t,i.response.statusText=e)}if(i.response)if(i.headers=i.response.headers,B.isNode)i.status=i.response.statusCode,i.statusText=i.response.statusMessage;else{const t=jt.parse(i.headers);i.headers=t,i.status=i.response.status,i.statusText=i.response.statusText}if(!f(t.pipelines.response))try{await Et.process(i,t.pipelines.response)}catch(e){const n=lt.createFromError.call(wt,e);return n.config=t,n.request=i.request,n.response=i.response,n.status=i.status,Promise.reject(n)}const o=Date.now()-e;return i.duration=o,Promise.resolve(i)}}(e),r=e.cache&&e.cache.enabled;if(r){const t=this.$cache.getCacheKey(e.url.href),r=this.$cache.get(t,!0);if(r){const e=await n({data:r.v,request:null,response:null,cache:{key:t,pulled:!0,hit:!0,stored:!1}});return Promise.resolve(e)}}const s=await this.$api.send(e),o=await n(s);return r&&!i(o.data)&&(this.$cache.set(e.url.href,o.data),o.cache.key=this.$cache.getCacheKey(e.url.href),o.cache.stored=!0),o.cache.hit=r,Promise.resolve(o)}catch(t){if(lt.isInstance(t))return Promise.reject(t);const e=lt.createFromError.call(lt,t);return e.message=t.message,Promise.reject(e)}}}const $t=["stream","raw"],At=new Et((t=>(S.includes(l(t.method))?t.headers.set({"Content-Type":"application/x-www-form-urlencoded"}):t.data=void 0,Promise.resolve(t)))),Ct=new Et((async t=>{const{responseType:e,maxContentLength:n}=t.config;if($t.includes(e)||t.cache.pulled)return Promise.resolve(t);const r=t.headers["content-encoding"];if(Buffer.isBuffer(t.data)&&t.data.length){if(r){const e=yt[r];if(e){const r=await e(t.data);if((n>-1||n!==1/0)&&r.length>n)throw new Error(`Content length of ${r.length} exceeds the maxContentLength of ${n}`);t.data=r}}}else t.data=null;return Promise.resolve(t)})),Ut=new Et((t=>{const{responseType:e,responseEncoding:n}=t.config;if($t.includes(e)||"arraybuffer"===e||t.cache.pulled)return Promise.resolve(t);if(t.data){let r=t.data;B.isNode&&(r=t.data.toString(n)),t.data="json"===e?function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{return JSON.parse(t)}catch(n){return e?t:null}}(r,!0):r}return Promise.resolve(t)}));function Lt(t,e){if(u(t))if(!(n=t).startsWith("//")&&n.startsWith("/")){if(!e)throw new Error("A valid URL string in the format of <scheme>://<hostname> must be passed when using `urbex.configure()`.");this.pathname=t}else this.parse(t);else void 0===t.origin&&(t.origin=""),t.href?this.parse(t.href):this.set(t).serialize(this.toJSON());var n}class qt{constructor(t){this.setup(),c(t)&&!f(t)&&this.set(this.createConfigurationObject(t,!0))}setup(){const t=B.getEnvironmentComponent(),e=w(j);e.request.push(At),e.response.push(Ut),B.isNode&&e.response.unshift(Ct);const n=m(w(O),{url:t,headers:new jt,pipelines:e});this.set(n)}defaultConfig(){return v(O,{url:B.getEnvironmentComponent(),headers:new jt})}createConfigurationObject(t,e){const n=this.parseIncomingConfig(t,e);return this.merge(n)}parseIncomingConfig(t,e){var n,r;if(P(t)||!c(t))throw new Error("The configuration must be an object with valid properties.");if(f(t))return{};const i=this.get(),o=p(t),a=p(i.url.toJSON()),d=new M;if(d.set(a),s(o,"url")){const t=o.url;if(!u(t)&&!c(t))throw new Error("The url property must be a string or an object.");Lt.call(d,t,e)}if(s(o,"method")){const t=l(o.method);if(!A.includes(t))throw new Error(`The method ${t} is not a valid HTTP method.`);o.method=t}const w=parseInt(null===(n=o.timeout)||void 0===n?void 0:n.toString(),10);isNaN(w)&&(o.timeout=O.timeout);const m=parseInt(null===(r=o.maxContentLength)||void 0===r?void 0:r.toString(),10);isNaN(m)&&(o.maxContentLength=O.maxContentLength),h(t.resolveStatus)||(t.resolveStatus=O.resolveStatus);const y=jt.construct(o.headers,!0);return o.headers=null,o.url=null,v(o,{headers:y,url:d})}set(t){return this.$config=t,t}merge(t){var e,n,r,s;if(P(t)||!c(t)||f(t))return this.get();const i=this.get(),o=null!==(e=null===(n=t.headers)||void 0===n?void 0:n.get())&&void 0!==e?e:{},u=null!==(r=null===(s=t.url)||void 0===s?void 0:s.toJSON())&&void 0!==r?r:{},h=v(i.headers.get(),o),a=v(i.url.toJSON(),u),l=m(i,t),d=jt.construct(h),p=new M;return p.set(a),v(l,{headers:d,url:p})}get(){return this.$config}reset(){this.setup()}}function It(t,e,n){if(P(e))throw new Error("Attempted to call a HTTP method without providing a URL. If you want to use the default URL, use `urbex.send` instead.");return v(n,{url:e,method:t})}class Rt extends Ot{constructor(t){super(),this.$config=new qt,c(t)&&!f(t)&&this.configure(t)}static create(t){return new Rt(t)}get config(){return this.$config.get()}get cache(){return this.$cache}configure(t){const e=this.$config.createConfigurationObject(t,!1);this.$config.set(e);const n=this.$cache;function r(){n&&(n.clear(),n.isRunning&&n.stop())}f(e.cache)?r():(n.configure(e.cache),e.cache.enabled?n&&n.isRunning||n.start():!1===e.cache.enabled&&r())}send(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this.$config.parseIncomingConfig(t,!0),n=this.$config.merge(e);return this.dispatchRequest(n)}injectPipeline(){}ejectPipeline(){}subscribe(){}unsubscribe(){}reset(){this.$cache&&(this.$cache.clear(),this.$cache.isRunning&&this.$cache.stop()),this.$config.reset()}}function Nt(t){return t instanceof Rt}g(["delete","get","head","options"],((t,e)=>{Rt.prototype[e]=function(t,n){return this.send(It(l(e),t,n))}})),g(["post","put","patch"],((t,e)=>{Rt.prototype[e]=function(t,n,r){const s=i(n)?n:c(r)?v(r,{data:n}):{data:n};return this.send(It(l(e),t,s))}}));const zt=function(){const t=Rt.create();return t.isolateClient=Rt.create,t.environment=B,t.isUrbexClient=Nt,t.Client=Rt,t}();return zt.PipelineExecutor=Et,zt.URLParser=M,zt.UrbexError=lt,zt.TimeoutError=dt,zt.NetworkError=pt,zt.PipelineError=wt,zt}));
//# sourceMappingURL=urbex.min.js.map
