/**
    * https://github.com/orison-networks/urbex#readme
    * (c) 2022 Orison Networks
    * @license MIT
    */
"use strict";Object.defineProperty(exports,"t",{value:!0});const t=require("cache-clock"),e=require("http"),r=require("https"),s=require("zlib"),n=require("util");function i(t,e){return t.hasOwnProperty.call(t,e)}function o(t){return void 0===t}function c(t){return Array.isArray(t)}function h(t){return"object"==typeof t&&null!==t&&!c(t)}function u(t){return"string"==typeof t}function a(t){return"function"==typeof t}function f(t){return"number"==typeof t}function l(t){return c(t)?0===t.length:h(t)?0===Object.keys(t).length:!t}function d(t){return String(t).toUpperCase()}function p(t){return String(t).toLowerCase()}function w(t){return c(t)?t.slice():h(t)?Object.assign({},t):t}function m(t){if(c(t))return t.map(m);if(h(t)&&t.constructor===Object){const e={};for(const r in t)i(t,r)&&(e[r]=m(t[r]));return e}return t}function g(t,e,r=!1){if(r){const r=(s=e,Object.keys(s)).reduce(((t,r)=>(e[r]&&(t[r]=e[r]),t)),{});return Object.assign({},t,r)}return Object.assign({},t,e);var s}function v(...t){return t.reduce(((t,e)=>{if(c(e))return t.concat(e);for(const r in e)c(t[r])&&c(e[r])?t[r]=t[r].concat(e[r]):h(t[r])&&h(e[r])?t[r]=v(t[r],e[r]):t[r]=e[r];return t}),{})}function E(t,e){if(!o(t))if(c(t))t.forEach((function(r,s){e.call(null,s,r,t)}));else for(const r in t)e.call(null,r,t[r],t)}function P(t,e){return x(e)?"":e.startsWith(t)?e:`${t}${e}`}function b(t,e){return x(e)?"":e.endsWith(t)?e:`${e}${t}`}function x(t){return null==t}function y(t="",...e){return e.filter((t=>!l(t))).join(t)}function T(t,e=null){return t.reduce(((t,r)=>{const s=r.split(".");if(1===s.length)t[r]=e;else{const[e,...r]=s;t[e]||(t[e]={});const n=T(r);t[e]=g(t[e],n)}return t}),{})}const L=["POST","PUT","PATCH"],q=["href","origin","protocol","username","password","hostname","port","pathname","search","searchParams","hash"];T(q,"");const U={request:[],response:[]},$={url:null,timeout:0,method:"GET",headers:null,data:null,cache:{},pipelines:U,maxContentLength:1/0,responseType:"json",responseEncoding:"utf8",resolveStatus:(t,e)=>e>=200&&e<300},S=T(["status","statusText","headers","data","config","request","response","duration","timestamp","cache.key","cache.hit","cache.pulled","cache.stored"]),j=["PUT","POST","PATCH","OPTIONS","HEAD","GET","DELETE"],R=/^(?:([^:\/?#]+):)?(?:[\/\/]+((?:([^@\/\n]+)@)?((?:[0-9]{1,3}\.){3}[0-9]{1,3}|\[[0-9a-f:]+\]|[^#:\/?\n]+)(?::(\d*))?))?(?:[\/]*([^?#]*))(?:[\?]*([^#]*))?(?:[\#]*(.*))?/i,C=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/,I=/^(\[[0-9a-f:]+\])$/i,A=/^([^:]+)(?:\:([^:].+))?/;function O(t){return t.replace(/%20/g,"")}function N(t){return t?f(t)||!t.startsWith(":")?`:${t}`:t:""}function z(t,e){if(!t&&e)throw new Error("Cannot set password without username.");return t?e?y(":",t,e):t:""}function H(t,e){return b(e||"http"===t||"https"===t?"://":":",t)}function D(t){return t.replace(/:\/\/$/,"").replace(/:$/,"")}function k(t){if(!t||!u(t)&&!h(t)&&!c(t))return{search:"",searchParams:null};if(u(t))return{search:P("?",O(t)),searchParams:new URLSearchParams(t)};const e=new URLSearchParams;return E(t,((r,s)=>{if(s)if(c(s)){const t=s;e.append(t[0],t[1])}else h(t)&&e.append(r,s)})),{search:P("?",e.toString()),searchParams:e}}class B{constructor(t){if(t&&!u(t)&&!h(t))throw new TypeError("Invalid input. Must be a string or an object.");this.$component=T(q,""),this.$component.searchParams=new URLSearchParams,u(t)&&t?this.$component=this.parse(t):!h(t)||l(t)||(t.href?this.$component=this.parse(t.href):this.serialize(t))}sync(t,e,r="all"){const s=this.$component.href,n=this.$component.origin;t&&("all"!==r&&"href"!==r||(this.$component.href=s.replace(t,e)),"all"!==r&&"origin"!==r||(this.$component.origin=n.replace(t,e)))}syncAuth(t,e,r){if(!e)throw new Error("Cannot set password without username.");let[s,n]=t.split("://");s=H(s,!!n);const i=y("",z(e,r),"@");this.$component.href=y("",s,i,n)}match(t){return R.exec(t)}parseProtocol(t){if(!t){const t=this.$component.protocol;return void(this.$component.protocol=t||"http")}const e=p(O(t=D(t)));this.$component.protocol=e}parseAuth(t){if(!t)return;const e=A.exec(t);if(!e||!e.length)throw new Error("Invalid auth format. Expected <username>:<password>");{const t=e[1],r=e[2];if(!t)throw new Error("Expected username in auth.");this.$component.username=t,this.$component.password=r||""}}parseHostname(t){t&&(t=C.test(t)?function(t){const e=C.exec(t);if(e){const t=e.slice(1).map((t=>parseInt(t,10)));if(t.every((t=>t<=255)))return t.join(".")}throw new Error("Invalid IPv4 address.")}(t):I.test(t)?function(t){const e=I.exec(t);if(e)return e[1];throw new Error("Invalid IPv6 address.")}(t):p(t),this.$component.hostname=O(t))}parsePort(t){if(!t)return void(this.$component.port="");const e=f(t)?t:parseInt(t,10);if(isNaN(e)||e<0||e>65535)throw new Error("Port must be between 0 and 65535.");this.$component.port=e}parseOrigin(t){const e=H(this.$component.protocol,!!this.$component.hostname);t&&this.$component.hostname?this.$component.origin=P(e,t):this.$component.origin="null";const r=z(this.$component.username,this.$component.password);if(r&&this.$component.origin.includes(r)){const t=y("",r,"@");this.$component.origin=this.$component.origin.replace(t,"")}}parsePathname(t){t&&(this.$component.hostname?this.$component.pathname=P("/",t):this.$component.pathname=t)}parseParams(t){if(!t)return;const e=k(t);e&&(this.$component.search=P("?",e.search),this.$component.searchParams=new URLSearchParams(e.searchParams))}parseHash(t){t&&(this.$component.hash=P("#",t))}parse(t,e=!0){if(!u(t)||l(t))throw new Error("Invalid URL.");const r=T(q,"");r.searchParams=new URLSearchParams,this.$component=e?r:g(r,this.$component),t=(t=(t=t.trim()).replace(/\s/g,"%20")).replace(/\\/g,"/");const s=this.match(t);if(null===s||0===s.length)throw new Error("Invalid URL.");const[n,i,o,c,h,a,f,d,p]=s;return this.parseProtocol(i),this.parseAuth(c),this.parseHostname(h),this.parsePort(a),this.parsePathname(f),this.parseParams(d),this.parseHash(p),this.parseOrigin(o),this.$component.href=n,this.$component}serialize(t,e=!0){const r=g(T(q,""),t),s=[],n=z(r.username,r.password);if(r.origin){const[t,e,i,o,c,h]=this.match(r.origin);if(s.push(H(e,!!c)),n&&!r.origin.includes(n)){const t=i.replace(`${o}@`,"");s.push(n),s.push("@"),s.push(t)}else o&&(s.push(o),s.push("@")),s.push(c),h&&s.push(N(h))}else{if(!r.protocol)throw new Error("Expected a protocol when serializing a URL.");if(("http"===r.protocol||"https"===r.protocol)&&!r.hostname)throw new Error("Expected a hostname when serializing a URL with an HTTP protocol.");s.push(H(r.protocol,!!r.hostname)),n&&(s.push(n),s.push("@")),r.hostname&&s.push(r.hostname),s.push(N(r.port))}s.push(P("/",r.pathname));const i=r.search||r.searchParams||"";if(i)if(i instanceof URLSearchParams){const t=i.toString();t&&s.push(P("?",t))}else{const{search:t}=k(i.toString());s.push(P("?",t))}r.hash&&s.push(P("#",r.hash));const o=s.filter((t=>t&&"/"!==t)).join("");try{return this.parse(o,e).href}catch(t){throw new Error("Attempted to serialize an invalid URL.")}}}class F extends B{constructor(t){super(t)}static parse(t){return new this(t)}static serialize(t){return(new this).serialize(t)}set(t){return this.$component=g(this.$component,t),t.searchParams instanceof URLSearchParams&&(this.$component.search=t.searchParams.toString(),this.$component.searchParams=t.searchParams),this}get href(){return this.$component.href}set href(t){this.parse(t)}get origin(){return this.$component.origin}set origin(t){const[e,r,s,n,i,o]=this.match(t);this.parseAuth(n);const c=g(this.$component,{href:"",origin:y("",H(r,!!i),s)});this.serialize(c)}get protocol(){return this.$component.protocol}set protocol(t){if(t===this.protocol)return;const e=H(this.protocol,!!this.hostname),r=H(D(t),!t.includes("data"));this.parseProtocol(t),this.sync(e,r)}get username(){return this.$component.username}set username(t){const e=this.username;if(t===this.username)return;const r=z(t,this.password);this.parseAuth(r),e?this.sync(e,t):this.origin&&this.syncAuth(this.origin,this.username,this.password)}get password(){return this.$component.password}set password(t){const e=this.password;if(t===e)return;const r=z(this.username,t);this.parseAuth(r),e?this.sync(e,t):this.origin&&this.syncAuth(this.origin,this.username,this.password)}get hostname(){return this.$component.hostname}set hostname(t){const e=this.hostname;t!==e&&(this.parseHostname(t),this.sync(e,this.hostname))}get port(){return this.$component.port}set port(t){const e=this.port.toString();if(t.toString()!==e)if(this.parsePort(t),e)this.sync(e,this.port.toString());else if(this.origin){const t=this.origin,e=y(":",t,this.port.toString());this.sync(t,e)}}get pathname(){return this.$component.pathname}set pathname(t){const e=this.pathname;if(t!==e)if(this.parsePathname(t),e)this.sync(e,this.pathname);else if(this.origin){const t=this.origin,e=y("",t,P("/",this.pathname));this.sync(t,e,"href")}}get search(){return k(this.$component.search).search}get searchParams(){return this.$component.searchParams}get hash(){return this.$component.hash}set hash(t){const e=this.hash;if(t!==e)if(this.parseHash(t),e)this.sync(e,this.hash,"href");else if(this.origin){const t=this.origin,e=y("",t,P("#",this.hash));this.sync(t,e,"href")}}setSearchParams(t,e=!1){const r=this.search;if(t!==r)if(t instanceof URLSearchParams&&(t=t.toString()),this.parseParams(t),r)this.sync(r,this.search,"href");else if(this.origin){const t=this.origin,e=y("",t,P("?",this.search));this.sync(t,e,"href")}}toString(){return this.$component.href}toJSON(){return this.$component}}const J=new class{constructor(){this.i=this.detectContext()}detectContext(){if("undefined"!=typeof window&&void 0!==window.document)return"browser";if("undefined"!=typeof process&&process.versions&&process.versions.node)return"node";throw new Error("Unable to detect environment context.")}nodeStrictCheck(){if(this.isBrowser)throw new Error("This method is not available in the browser environment.")}get process(){return this.isNode?process:{}}get context(){return this.i}get isBrowser(){return"browser"===this.context}get isNode(){return"node"===this.context}get isDevelopment(){return this.nodeStrictCheck(),"development"===process.env.NODE_ENV}get isProduction(){return this.nodeStrictCheck(),"production"===process.env.NODE_ENV}getEnvironmentComponent(){if(this.isBrowser)return F.parse(window.location.href);{const t=process.env.PORT||"3000";return F.parse(`http://localhost:${t}`)}}};class M extends Error{message="An error occurred while executing a request.";static create(t){const e=new this;return e.config=t,e.name=this.name,e}static createErrorInstance(t){const e=t.create.call(t,this.config);return e.request=this.request,e}static createFromError(t){t instanceof Error||(t=new Error(t));const e=new this(t.message);var r,s;return t.stack&&(e.stack=(r=t.stack,s=this.name,r.replace(/^Error/,s))),e.name=this.name,M.isInstance(t)&&(e.name=t.name),e}static isInstance(t){return t instanceof M}}class G extends M{constructor(t){super(),this.name="TimeoutError",this.message=t||"The request timed out."}}class _ extends M{constructor(t){super(),this.name="NetworkError",this.message=t||"Failed to request the resource."}}class X extends M{constructor(t){super(),this.name="PipelineError",this.message=t||"An error occurred while executing a pipeline."}}function K(t,e,r){const s=J.isNode?r.response.statusCode:r.response.status;try{if(this.config.resolveStatus(this.config,s))return t(r);const n=M.createErrorInstance.call(this,M);return n.status=s,n.response=r.response,n.request=this.request,J.isNode?n.message=r.response.statusMessage:n.message=r.response.statusText,n.message||(n.message=`Request failed with status code ${s}`),e(n)}catch(t){const n=M.createFromError.call(M,t);return n.message=t.message,n.config=this.config,n.request=this.request,n.response=r.response,n.status=s,e(n)}}class Q{getAgentFromProtocol(t){return"https"===t?r:e}handleDataProtocolRequest(t){return new Promise(((t,e)=>{t({data:null,request:null,response:null})}))}async send(t){return new Promise(((e,r)=>{const s=this.getAgentFromProtocol(t.url.protocol);if("data"===t.url.protocol)return this.handleDataProtocolRequest(t);t.headers.has("Accept-Encoding")||t.headers.set({"Accept-Encoding":"gzip, deflate, br"});const n={protocol:b(":",t.url.protocol),href:t.url.href,hostname:t.url.hostname,path:y("",t.url.pathname,t.url.search),headers:t.headers.get(),timeout:t.timeout};t.url.port&&(n.port=t.url.port);const i=s.request(n);function o(s){return K.call({config:t,request:i},e,r,s)}function c(e,r){const s=M.createFromError.call(e,r);return s.config=t,s.request=i,s}function h(t){this.push(t)}function u(t){if(t instanceof M)return r(t);const e=c(_,t);return r(e)}function a(){this.complete||this.aborted||this.destroyed||(this.destroy(),i.destroy())}function f(t){o({data:Buffer.concat(this),request:i,response:t}),a.call(t)}i.on("response",(function(e){if(e.destroyed||i.destroyed)return;if("stream"===t.responseType)return o({data:e,request:i,response:e});const r=[];e.on("data",(t=>{h.call(r,t)})),e.on("error",(t=>{u.call(e,t)})),e.on("close",(()=>{a.call(e)})),e.on("end",(()=>{f.call(r,e)}))})),i.on("error",(t=>{u.call(i,t)})),t.timeout&&i.on("timeout",(function(){const e=new Error(`Timeout of ${t.timeout}ms exceeded`),r=c(G,e);i.destroy(r)})),i.end(t.data??void 0)}))}}const V={br:a(null==s?void 0:s.brotliDecompress)?n.promisify(s.brotliDecompress):null,gzip:a(null==s?void 0:s.gunzip)?n.promisify(s.gunzip):null,deflate:a(null==s?void 0:s.inflate)?n.promisify(s.inflate):null,compress:a(null==s?void 0:s.createUnzip)?n.promisify(s.createUnzip):null},W=["arraybuffer","blob","document","json","text"];class Y{send(t){return new Promise(((e,r)=>{const s=new XMLHttpRequest;function n(t,e){for(const{event:r,listener:n}of t)s[e](r,n)}function i(e,r){const n=M.createFromError.call(e,r);return n.config=t,n.request=s,n}s.open(d(t.method),t.url.href,!0),W.includes(t.responseType)&&"json"!==t.responseType&&(s.responseType=t.responseType),o(t.data)&&t.headers.delete("Content-Type"),E(t.headers.get(),s.setRequestHeader.bind(s)),t.timeout&&(s.timeout=t.timeout);const c=[{event:"timeout",listener:function(e){const s=new Error(`Timeout of ${t.timeout}ms exceeded`),o=i(G,s);r(o),n(c,"removeEventListener")}},{event:"abort",listener:function(t){const e=i(M,new Error("Request was aborted"));e.message="The request was aborted.",r(e),n(c,"removeEventListener")}},{event:"error",listener:function(t){const e=i(_,new Error("Network Error"));r(e),n(c,"removeEventListener")}},{event:"load",listener:function(i){var o;o={data:"document"===s.responseType?s.responseXML:s.responseType&&"text"!==s.responseType?s.response:s.responseText,request:s,response:{status:s.status,statusText:s.statusText,headers:s.getAllResponseHeaders()}},K.call({config:t,request:s},e,r,o),n(c,"removeEventListener")}}];n(c,"addEventListener"),s.onreadystatechange=function(){},s.send(t.data)}))}}T(["br","gzip","deflate","compress"]);class Z{$executor=null;constructor(t){this.$executor=t}static async process(t,e){for(const r of e){if(!(r instanceof Z))throw new X("Urbex expected a valid pipeline to be passed to the `process` method.");const e=await r.execute(t);if(!h(e))throw new X("Urbex expected a valid configuration to be returned from a pipeline.");t=t}}async execute(t){return this.$executor(t)}}const tt={"Content-Type":"application/json"},et=g(tt,{"User-Agent":`UrbexClient (Node.js ${J.process.version}; ${J.process.platform})`});function rt(t){return function(t,e,r){return t.replace("\n","")}(t)}function st(t){if(t){const e=function(t){return t.split("-").map((t=>{const e=rt(t).trim();if(e)return r=e,1===(r=String(r)).length?r.toUpperCase():r.charAt(0).toUpperCase()+r.slice(1);var r})).join("-")}(p(t)).trim();return rt(e)}}function nt(t){if(!o(t)&&!1!==t&&null!==t)return c(t)?t.join(", "):h(t)?JSON.stringify(t):rt(t.toString().trim())}class it{$headers={};constructor(t,e=!0){e&&this.set(this.defaults,!1),h(t)&&!l(t)&&this.set(t,e)}static construct(t={},e=!0){return new it(t,e)}static parse(t){if(x(t)||!u(t))return{};const e={};return E(t.split("\r"),((t,r)=>{const[s,n]=r.toString().split(":"),i=st(s),o=nt(n);i&&o&&(e[i]=o)})),e}get defaults(){return J.isNode?et:tt}set(t,e=!0){if(!h(t))return r="Attempted to set headers with a non-object value: "+typeof t,console.error(`[urbex] ${r}`),t;var r;const s=this.normalize(t),n=e?g(this.$headers,s):s;return this.$headers=n}get(){return this.$headers}has(t){return i(this.$headers,st(t))}delete(t){E(this.$headers,(e=>{e.toLowerCase()===t.toLowerCase()&&delete this.$headers[e]}))}clear(t=!1){this.$headers={},t||this.set(this.defaults,!1)}normalize(t){return x(t)||!h(t)?{}:function(t){const e={};return E(t,((t,r)=>{if(o(t)||o(r))return;const s=st(t),n=nt(r);s&&n&&(e[s]=n)})),e}(t)}}class ot{constructor(){this.register(J.context),this.$cache=new t.CacheClock({autoStart:!1,debug:!1})}register(t){if("browser"!==t){if("node"!==t)throw new Error(`Urbex expected a valid context to register a request api, but got ${t}.`);this.$api=new Q}else this.$api=new Y}async dispatchRequest(t){try{const e=t,r=await async function(t){const e=Date.now(),r=(new Date).toISOString(),s=m(S);if(!l(t.pipelines.request))try{await Z.process(t,t.pipelines.request)}catch(e){const r=M.createFromError.call(X,e);return r.config=t,Promise.reject(r)}return async function(n){const i=v(s,{data:n.data,config:t,request:n.request||{},response:n.response||{},timestamp:r,responseType:t.responseType,cache:n.cache||{}});if(i.cache&&i.cache.hit){const t=200,e="Pulled from internal cache.";J.isNode?(i.response.statusCode=t,i.response.statusMessage=e):(i.response.status=t,i.response.statusText=e)}if(i.response)if(i.headers=i.response.headers,J.isNode)i.status=i.response.statusCode,i.statusText=i.response.statusMessage;else{const t=it.parse(i.headers);i.headers=t,i.status=i.response.status,i.statusText=i.response.statusText}if(!l(t.pipelines.response))try{await Z.process(i,t.pipelines.response)}catch(e){const r=M.createFromError.call(X,e);return r.config=t,r.request=i.request,r.response=i.response,r.status=i.status,Promise.reject(r)}const o=Date.now()-e;return i.duration=o,Promise.resolve(i)}}(e),s=e.cache&&e.cache.enabled;if(s){const t=this.$cache.getCacheKey(e.url.href),s=this.$cache.get(t,!0);if(s){const e=await r({data:s.v,request:null,response:null,cache:{key:t,pulled:!0,hit:!0,stored:!1}});return Promise.resolve(e)}}const n=await this.$api.send(e),i=await r(n);return s&&!o(i.data)&&(this.$cache.set(e.url.href,i.data),i.cache.key=this.$cache.getCacheKey(e.url.href),i.cache.stored=!0),i.cache.hit=s,Promise.resolve(i)}catch(t){if(M.isInstance(t))return Promise.reject(t);const e=M.createFromError.call(M,t);return e.message=t.message,Promise.reject(e)}}}const ct=["stream","raw"],ht=new Z((t=>(L.includes(d(t.method))?t.headers.set({"Content-Type":"application/x-www-form-urlencoded"}):t.data=void 0,Promise.resolve(t)))),ut=new Z((async t=>{const{responseType:e,maxContentLength:r}=t.config;if(ct.includes(e)||t.cache.pulled)return Promise.resolve(t);const s=t.headers["content-encoding"];if(Buffer.isBuffer(t.data)&&t.data.length){if(s){const e=V[s];if(e){const s=await e(t.data);if((r>-1||r!==1/0)&&s.length>r)throw new Error(`Content length of ${s.length} exceeds the maxContentLength of ${r}`);t.data=s}}}else t.data=null;return Promise.resolve(t)})),at=new Z((t=>{const{responseType:e,responseEncoding:r}=t.config;if(ct.includes(e)||"arraybuffer"===e||t.cache.pulled)return Promise.resolve(t);if(t.data){let s=t.data;J.isNode&&(s=t.data.toString(r)),t.data="json"===e?function(t,e=!1){try{return JSON.parse(t)}catch(r){return e?t:null}}(s,!0):s}return Promise.resolve(t)}));function ft(t,e){if(u(t))if(!(r=t).startsWith("//")&&r.startsWith("/")){if(!e)throw new Error("A valid URL string in the format of <scheme>://<hostname> must be passed when using `urbex.configure()`.");this.pathname=t}else this.parse(t);else void 0===t.origin&&(t.origin=""),t.href?this.parse(t.href):this.set(t).serialize(this.toJSON());var r}class lt{constructor(t){this.setup(),h(t)&&!l(t)&&this.set(this.createConfigurationObject(t,!0))}setup(){const t=J.getEnvironmentComponent(),e=m(U);e.request.push(ht),e.response.push(at),J.isNode&&e.response.unshift(ut);const r=v(m($),{url:t,headers:new it,pipelines:e});this.set(r)}defaultConfig(){return g($,{url:J.getEnvironmentComponent(),headers:new it})}createConfigurationObject(t,e){const r=this.parseIncomingConfig(t,e);return this.merge(r)}parseIncomingConfig(t,e){var r,s;if(x(t)||!h(t))throw new Error("The configuration must be an object with valid properties.");if(l(t))return{};const n=this.get(),o=w(t),c=w(n.url.toJSON()),f=new F;if(f.set(c),i(o,"url")){const t=o.url;if(!u(t)&&!h(t))throw new Error("The url property must be a string or an object.");ft.call(f,t,e)}if(i(o,"method")){const t=d(o.method);if(!j.includes(t))throw new Error(`The method ${t} is not a valid HTTP method.`);o.method=t}const p=parseInt(null===(r=o.timeout)||void 0===r?void 0:r.toString(),10);isNaN(p)&&(o.timeout=$.timeout);const m=parseInt(null===(s=o.maxContentLength)||void 0===s?void 0:s.toString(),10);isNaN(m)&&(o.maxContentLength=$.maxContentLength),a(t.resolveStatus)||(t.resolveStatus=$.resolveStatus);const v=it.construct(o.headers,!0);return o.headers=null,o.url=null,g(o,{headers:v,url:f})}set(t){return this.$config=t,t}merge(t){var e,r;if(x(t)||!h(t)||l(t))return this.get();const s=this.get(),n=(null===(e=t.headers)||void 0===e?void 0:e.get())??{},i=(null===(r=t.url)||void 0===r?void 0:r.toJSON())??{},o=g(s.headers.get(),n),c=g(s.url.toJSON(),i),u=v(s,t),a=it.construct(o),f=new F;return f.set(c),g(u,{headers:a,url:f})}get(){return this.$config}reset(){this.setup()}}function dt(t,e,r){if(x(e))throw new Error("Attempted to call a HTTP method without providing a URL. If you want to use the default URL, use `urbex.send` instead.");return g(r,{url:e,method:t})}class pt extends ot{constructor(t){super(),this.$config=new lt,h(t)&&!l(t)&&this.configure(t)}static create(t){return new pt(t)}get config(){return this.$config.get()}get cache(){return this.$cache}configure(t){const e=this.$config.createConfigurationObject(t,!1);this.$config.set(e);const r=this.$cache;function s(){r&&(r.clear(),r.isRunning&&r.stop())}l(e.cache)?s():(r.configure(e.cache),e.cache.enabled?r&&r.isRunning||r.start():!1===e.cache.enabled&&s())}send(t={}){const e=this.$config.parseIncomingConfig(t,!0),r=this.$config.merge(e);return this.dispatchRequest(r)}injectPipeline(){}ejectPipeline(){}subscribe(){}unsubscribe(){}reset(){this.$cache&&(this.$cache.clear(),this.$cache.isRunning&&this.$cache.stop()),this.$config.reset()}}function wt(t){return t instanceof pt}E(["delete","get","head","options"],((t,e)=>{pt.prototype[e]=function(t,r){return this.send(dt(d(e),t,r))}})),E(["post","put","patch"],((t,e)=>{pt.prototype[e]=function(t,r,s){const n=o(r)?r:h(s)?g(s,{data:r}):{data:r};return this.send(dt(d(e),t,n))}}));const mt=function(){const t=pt.create();return t.isolateClient=pt.create,t.environment=J,t.isUrbexClient=wt,t.Client=pt,t}();exports.NetworkError=_,exports.PipelineError=X,exports.PipelineExecutor=Z,exports.TimeoutError=G,exports.URLParser=F,exports.UrbexError=M,exports.default=mt;
//# sourceMappingURL=urbex.min.cjs.map
