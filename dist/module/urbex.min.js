/**
    * https://github.com/orison-networks/urbex#readme
    * (c) 2022 Orison Networks
    * @license MIT
    */
import{CacheClock as t}from"cache-clock";import e from"http";import r from"https";import n from"zlib";import s from"util";function i(t,e){return t.hasOwnProperty.call(t,e)}function o(t){return void 0===t}function c(t){return Array.isArray(t)}function h(t){return"object"==typeof t&&null!==t&&!c(t)}function u(t){return"string"==typeof t}function a(t){return"function"==typeof t}function f(t){return"number"==typeof t}function l(t){return c(t)?0===t.length:h(t)?0===Object.keys(t).length:!t}function d(t){return String(t).toUpperCase()}function p(t){return String(t).toLowerCase()}function w(t){return c(t)?t.slice():h(t)?Object.assign({},t):t}function m(t){if(c(t))return t.map(m);if(h(t)&&t.constructor===Object){const e={};for(const r in t)i(t,r)&&(e[r]=m(t[r]));return e}return t}function v(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(r){const r=E(e).reduce(((t,r)=>(e[r]&&(t[r]=e[r]),t)),{});return Object.assign({},t,r)}return Object.assign({},t,e)}function g(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.reduce(((t,e)=>{if(c(e))return t.concat(e);for(const r in e)c(t[r])&&c(e[r])?t[r]=t[r].concat(e[r]):h(t[r])&&h(e[r])?t[r]=g(t[r],e[r]):t[r]=e[r];return t}),{})}function E(t){return Object.keys(t)}function b(t,e){if(!o(t))if(c(t))t.forEach((function(r,n){e.call(null,n,r,t)}));else for(const r in t)e.call(null,r,t[r],t)}function P(t,e){return y(e)?"":e.startsWith(t)?e:`${t}${e}`}function x(t,e){return y(e)?"":e.endsWith(t)?e:`${e}${t}`}function y(t){return null==t}function T(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return r.filter((t=>!l(t))).join(t)}function L(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t.reduce(((t,r)=>{const n=r.split(".");if(1===n.length)t[r]=e;else{const[e,...r]=n;t[e]||(t[e]={});const s=L(r);t[e]=v(t[e],s)}return t}),{})}const U=["POST","PUT","PATCH"],$=["href","origin","protocol","username","password","hostname","port","pathname","search","searchParams","hash"];L($,"");const S={request:[],response:[]},j={url:null,timeout:0,method:"GET",headers:null,data:null,cache:{},pipelines:S,maxContentLength:1/0,responseType:"json",responseEncoding:"utf8",resolveStatus:(t,e)=>e>=200&&e<300},R=L(["status","statusText","headers","data","config","request","response","duration","timestamp","cache.key","cache.hit","cache.pulled","cache.stored"]),q=["PUT","POST","PATCH","OPTIONS","HEAD","GET","DELETE"],A=/^(?:([^:\/?#]+):)?(?:[\/\/]+((?:([^@\/\n]+)@)?((?:[0-9]{1,3}\.){3}[0-9]{1,3}|\[[0-9a-f:]+\]|[^#:\/?\n]+)(?::(\d*))?))?(?:[\/]*([^?#]*))(?:[\?]*([^#]*))?(?:[\#]*(.*))?/i,C=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/,I=/^(\[[0-9a-f:]+\])$/i,O=/^([^:]+)(?:\:([^:].+))?/;function N(t){return t.replace(/%20/g,"")}function z(t){return t?f(t)||!t.startsWith(":")?`:${t}`:t:""}function H(t,e){if(!t&&e)throw new Error("Cannot set password without username.");return t?e?T(":",t,e):t:""}function D(t,e){return x(e||"http"===t||"https"===t?"://":":",t)}function k(t){return t.replace(/:\/\/$/,"").replace(/:$/,"")}function B(t){if(!t||!u(t)&&!h(t)&&!c(t))return{search:"",searchParams:null};if(u(t))return{search:P("?",N(t)),searchParams:new URLSearchParams(t)};const e=new URLSearchParams;return b(t,((r,n)=>{if(n)if(c(n)){const t=n;e.append(t[0],t[1])}else h(t)&&e.append(r,n)})),{search:P("?",e.toString()),searchParams:e}}class F{constructor(t){if(t&&!u(t)&&!h(t))throw new TypeError("Invalid input. Must be a string or an object.");this.$component=L($,""),this.$component.searchParams=new URLSearchParams,u(t)&&t?this.$component=this.parse(t):!h(t)||l(t)||(t.href?this.$component=this.parse(t.href):this.serialize(t))}sync(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"all";const n=this.$component.href,s=this.$component.origin;t&&("all"!==r&&"href"!==r||(this.$component.href=n.replace(t,e)),"all"!==r&&"origin"!==r||(this.$component.origin=s.replace(t,e)))}syncAuth(t,e,r){if(!e)throw new Error("Cannot set password without username.");let[n,s]=t.split("://");n=D(n,!!s);const i=T("",H(e,r),"@");this.$component.href=T("",n,i,s)}match(t){return A.exec(t)}parseProtocol(t){if(!t){const t=this.$component.protocol;return void(this.$component.protocol=t||"http")}const e=p(N(t=k(t)));this.$component.protocol=e}parseAuth(t){if(!t)return;const e=O.exec(t);if(!e||!e.length)throw new Error("Invalid auth format. Expected <username>:<password>");{const t=e[1],r=e[2];if(!t)throw new Error("Expected username in auth.");this.$component.username=t,this.$component.password=r||""}}parseHostname(t){t&&(t=C.test(t)?function(t){const e=C.exec(t);if(e){const t=e.slice(1).map((t=>parseInt(t,10)));if(t.every((t=>t<=255)))return t.join(".")}throw new Error("Invalid IPv4 address.")}(t):I.test(t)?function(t){const e=I.exec(t);if(e)return e[1];throw new Error("Invalid IPv6 address.")}(t):p(t),this.$component.hostname=N(t))}parsePort(t){if(!t)return void(this.$component.port="");const e=f(t)?t:parseInt(t,10);if(isNaN(e)||e<0||e>65535)throw new Error("Port must be between 0 and 65535.");this.$component.port=e}parseOrigin(t){const e=D(this.$component.protocol,!!this.$component.hostname);t&&this.$component.hostname?this.$component.origin=P(e,t):this.$component.origin="null";const r=H(this.$component.username,this.$component.password);if(r&&this.$component.origin.includes(r)){const t=T("",r,"@");this.$component.origin=this.$component.origin.replace(t,"")}}parsePathname(t){t&&(this.$component.hostname?this.$component.pathname=P("/",t):this.$component.pathname=t)}parseParams(t){if(!t)return;const e=B(t);e&&(this.$component.search=P("?",e.search),this.$component.searchParams=new URLSearchParams(e.searchParams))}parseHash(t){t&&(this.$component.hash=P("#",t))}parse(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!u(t)||l(t))throw new Error("Invalid URL.");const r=L($,"");r.searchParams=new URLSearchParams,this.$component=e?r:v(r,this.$component),t=(t=(t=t.trim()).replace(/\s/g,"%20")).replace(/\\/g,"/");const n=this.match(t);if(null===n||0===n.length)throw new Error("Invalid URL.");const[s,i,o,c,h,a,f,d,p]=n;return this.parseProtocol(i),this.parseAuth(c),this.parseHostname(h),this.parsePort(a),this.parsePathname(f),this.parseParams(d),this.parseHash(p),this.parseOrigin(o),this.$component.href=s,this.$component}serialize(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const r=v(L($,""),t),n=[],s=H(r.username,r.password);if(r.origin){const[t,e,i,o,c,h]=this.match(r.origin);if(n.push(D(e,!!c)),s&&!r.origin.includes(s)){const t=i.replace(`${o}@`,"");n.push(s),n.push("@"),n.push(t)}else o&&(n.push(o),n.push("@")),n.push(c),h&&n.push(z(h))}else{if(!r.protocol)throw new Error("Expected a protocol when serializing a URL.");if(("http"===r.protocol||"https"===r.protocol)&&!r.hostname)throw new Error("Expected a hostname when serializing a URL with an HTTP protocol.");n.push(D(r.protocol,!!r.hostname)),s&&(n.push(s),n.push("@")),r.hostname&&n.push(r.hostname),n.push(z(r.port))}n.push(P("/",r.pathname));const i=r.search||r.searchParams||"";if(i)if(i instanceof URLSearchParams){const t=i.toString();t&&n.push(P("?",t))}else{const{search:t}=B(i.toString());n.push(P("?",t))}r.hash&&n.push(P("#",r.hash));const o=n.filter((t=>t&&"/"!==t)).join("");try{return this.parse(o,e).href}catch(t){throw new Error("Attempted to serialize an invalid URL.")}}}class J extends F{constructor(t){super(t)}static parse(t){return new this(t)}static serialize(t){return(new this).serialize(t)}set(t){return this.$component=v(this.$component,t),t.searchParams instanceof URLSearchParams&&(this.$component.search=t.searchParams.toString(),this.$component.searchParams=t.searchParams),this}get href(){return this.$component.href}set href(t){this.parse(t)}get origin(){return this.$component.origin}set origin(t){const[e,r,n,s,i,o]=this.match(t);this.parseAuth(s);const c=v(this.$component,{href:"",origin:T("",D(r,!!i),n)});this.serialize(c)}get protocol(){return this.$component.protocol}set protocol(t){if(t===this.protocol)return;const e=D(this.protocol,!!this.hostname),r=D(k(t),!t.includes("data"));this.parseProtocol(t),this.sync(e,r)}get username(){return this.$component.username}set username(t){const e=this.username;if(t===this.username)return;const r=H(t,this.password);this.parseAuth(r),e?this.sync(e,t):this.origin&&this.syncAuth(this.origin,this.username,this.password)}get password(){return this.$component.password}set password(t){const e=this.password;if(t===e)return;const r=H(this.username,t);this.parseAuth(r),e?this.sync(e,t):this.origin&&this.syncAuth(this.origin,this.username,this.password)}get hostname(){return this.$component.hostname}set hostname(t){const e=this.hostname;t!==e&&(this.parseHostname(t),this.sync(e,this.hostname))}get port(){return this.$component.port}set port(t){const e=this.port.toString();if(t.toString()!==e)if(this.parsePort(t),e)this.sync(e,this.port.toString());else if(this.origin){const t=this.origin,e=T(":",t,this.port.toString());this.sync(t,e)}}get pathname(){return this.$component.pathname}set pathname(t){const e=this.pathname;if(t!==e)if(this.parsePathname(t),e)this.sync(e,this.pathname);else if(this.origin){const t=this.origin,e=T("",t,P("/",this.pathname));this.sync(t,e,"href")}}get search(){return B(this.$component.search).search}get searchParams(){return this.$component.searchParams}get hash(){return this.$component.hash}set hash(t){const e=this.hash;if(t!==e)if(this.parseHash(t),e)this.sync(e,this.hash,"href");else if(this.origin){const t=this.origin,e=T("",t,P("#",this.hash));this.sync(t,e,"href")}}setSearchParams(t){const e=this.search;if(t!==e)if(t instanceof URLSearchParams&&(t=t.toString()),this.parseParams(t),e)this.sync(e,this.search,"href");else if(this.origin){const t=this.origin,e=T("",t,P("?",this.search));this.sync(t,e,"href")}}toString(){return this.$component.href}toJSON(){return this.$component}}const G=new class{constructor(){this.t=this.detectContext()}detectContext(){if("undefined"!=typeof window&&void 0!==window.document)return"browser";if("undefined"!=typeof process&&process.versions&&process.versions.node)return"node";throw new Error("Unable to detect environment context.")}nodeStrictCheck(){if(this.isBrowser)throw new Error("This method is not available in the browser environment.")}get process(){return this.isNode?process:{}}get context(){return this.t}get isBrowser(){return"browser"===this.context}get isNode(){return"node"===this.context}get isDevelopment(){return this.nodeStrictCheck(),"development"===process.env.NODE_ENV}get isProduction(){return this.nodeStrictCheck(),"production"===process.env.NODE_ENV}getEnvironmentComponent(){if(this.isBrowser)return J.parse(window.location.href);{const t=process.env.PORT||"3000";return J.parse(`http://localhost:${t}`)}}};function M(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class X extends Error{constructor(){super(...arguments),M(this,"message","An error occurred while executing a request.")}static create(t){const e=new this;return e.config=t,e.name=this.name,e}static createErrorInstance(t){const e=t.create.call(t,this.config);return e.request=this.request,e}static createFromError(t){t instanceof Error||(t=new Error(t));const e=new this(t.message);var r,n;return t.stack&&(e.stack=(r=t.stack,n=this.name,r.replace(/^Error/,n))),e.name=this.name,X.isInstance(t)&&(e.name=t.name),e}static isInstance(t){return t instanceof X}}class K extends X{constructor(t){super(),this.name="TimeoutError",this.message=t||"The request timed out."}}class Q extends X{constructor(t){super(),this.name="NetworkError",this.message=t||"Failed to request the resource."}}class V extends X{constructor(t){super(),this.name="PipelineError",this.message=t||"An error occurred while executing a pipeline."}}function W(t,e,r){const n=G.isNode?r.response.statusCode:r.response.status;try{if(this.config.resolveStatus(this.config,n))return t(r);const s=X.createErrorInstance.call(this,X);return s.status=n,s.response=r.response,s.request=this.request,G.isNode?s.message=r.response.statusMessage:s.message=r.response.statusText,s.message||(s.message=`Request failed with status code ${n}`),e(s)}catch(t){const s=X.createFromError.call(X,t);return s.message=t.message,s.config=this.config,s.request=this.request,s.response=r.response,s.status=n,e(s)}}class Y{getAgentFromProtocol(t){return"https"===t?r:e}handleDataProtocolRequest(t){return new Promise(((t,e)=>{t({data:null,request:null,response:null})}))}async send(t){return new Promise(((e,r)=>{var n;const s=this.getAgentFromProtocol(t.url.protocol);if("data"===t.url.protocol)return this.handleDataProtocolRequest(t);t.headers.has("Accept-Encoding")||t.headers.set({"Accept-Encoding":"gzip, deflate, br"});const i={protocol:x(":",t.url.protocol),href:t.url.href,hostname:t.url.hostname,path:T("",t.url.pathname,t.url.search),headers:t.headers.get(),timeout:t.timeout};t.url.port&&(i.port=t.url.port);const o=s.request(i);function c(n){return W.call({config:t,request:o},e,r,n)}function h(e,r){const n=X.createFromError.call(e,r);return n.config=t,n.request=o,n}function u(t){this.push(t)}function a(t){if(t instanceof X)return r(t);const e=h(Q,t);return r(e)}function f(){this.complete||this.aborted||this.destroyed||(this.destroy(),o.destroy())}function l(t){c({data:Buffer.concat(this),request:o,response:t}),f.call(t)}o.on("response",(function(e){if(e.destroyed||o.destroyed)return;if("stream"===t.responseType)return c({data:e,request:o,response:e});const r=[];e.on("data",(t=>{u.call(r,t)})),e.on("error",(t=>{a.call(e,t)})),e.on("close",(()=>{f.call(e)})),e.on("end",(()=>{l.call(r,e)}))})),o.on("error",(t=>{a.call(o,t)})),t.timeout&&o.on("timeout",(function(){const e=new Error(`Timeout of ${t.timeout}ms exceeded`),r=h(K,e);o.destroy(r)})),o.end(null!==(n=t.data)&&void 0!==n?n:void 0)}))}}const Z={br:a(null==n?void 0:n.brotliDecompress)?s.promisify(n.brotliDecompress):null,gzip:a(null==n?void 0:n.gunzip)?s.promisify(n.gunzip):null,deflate:a(null==n?void 0:n.inflate)?s.promisify(n.inflate):null,compress:a(null==n?void 0:n.createUnzip)?s.promisify(n.createUnzip):null},_=["arraybuffer","blob","document","json","text"];class tt{send(t){return new Promise(((e,r)=>{const n=new XMLHttpRequest;function s(t,e){for(const{event:r,listener:s}of t)n[e](r,s)}function i(e,r){const s=X.createFromError.call(e,r);return s.config=t,s.request=n,s}n.open(d(t.method),t.url.href,!0),_.includes(t.responseType)&&"json"!==t.responseType&&(n.responseType=t.responseType),o(t.data)&&t.headers.delete("Content-Type"),b(t.headers.get(),n.setRequestHeader.bind(n)),t.timeout&&(n.timeout=t.timeout);const c=[{event:"timeout",listener:function(e){const n=new Error(`Timeout of ${t.timeout}ms exceeded`),o=i(K,n);r(o),s(c,"removeEventListener")}},{event:"abort",listener:function(t){const e=i(X,new Error("Request was aborted"));e.message="The request was aborted.",r(e),s(c,"removeEventListener")}},{event:"error",listener:function(t){const e=i(Q,new Error("Network Error"));r(e),s(c,"removeEventListener")}},{event:"load",listener:function(i){var o;o={data:"document"===n.responseType?n.responseXML:n.responseType&&"text"!==n.responseType?n.response:n.responseText,request:n,response:{status:n.status,statusText:n.statusText,headers:n.getAllResponseHeaders()}},W.call({config:t,request:n},e,r,o),s(c,"removeEventListener")}}];s(c,"addEventListener"),n.onreadystatechange=function(){},n.send(t.data)}))}}L(["br","gzip","deflate","compress"]);class et{constructor(t){M(this,"$executor",null),this.$executor=t}static async process(t,e){for(const r of e){if(!(r instanceof et))throw new V("Urbex expected a valid pipeline to be passed to the `process` method.");const e=await r.execute(t);if(!h(e))throw new V("Urbex expected a valid configuration to be returned from a pipeline.");t=t}}async execute(t){return this.$executor(t)}}const rt={"Content-Type":"application/json"},nt=v(rt,{"User-Agent":`UrbexClient (Node.js ${G.process.version}; ${G.process.platform})`});function st(t){return function(t,e,r){return t.replace("\n","")}(t)}function it(t){if(t){const e=function(t){return t.split("-").map((t=>{const e=st(t).trim();if(e)return r=e,1===(r=String(r)).length?r.toUpperCase():r.charAt(0).toUpperCase()+r.slice(1);var r})).join("-")}(p(t)).trim();return st(e)}}function ot(t){if(!o(t)&&!1!==t&&null!==t)return c(t)?t.join(", "):h(t)?JSON.stringify(t):st(t.toString().trim())}class ct{constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];M(this,"$headers",{}),e&&this.set(this.defaults,!1),h(t)&&!l(t)&&this.set(t,e)}static construct(){return new ct(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}static parse(t){if(y(t)||!u(t))return{};const e={};return b(t.split("\r"),((t,r)=>{const[n,s]=r.toString().split(":"),i=it(n),o=ot(s);i&&o&&(e[i]=o)})),e}get defaults(){return G.isNode?nt:rt}set(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!h(t))return r="Attempted to set headers with a non-object value: "+typeof t,console.error(`[urbex] ${r}`),t;var r;const n=this.normalize(t),s=e?v(this.$headers,n):n;return this.$headers=s}get(){return this.$headers}has(t){return i(this.$headers,it(t))}delete(t){b(this.$headers,(e=>{e.toLowerCase()===t.toLowerCase()&&delete this.$headers[e]}))}clear(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$headers={},t||this.set(this.defaults,!1)}normalize(t){return y(t)||!h(t)?{}:function(t){const e={};return b(t,((t,r)=>{if(o(t)||o(r))return;const n=it(t),s=ot(r);n&&s&&(e[n]=s)})),e}(t)}}class ht{constructor(){this.register(G.context),this.$cache=new t({autoStart:!1,debug:!1})}register(t){if("browser"!==t){if("node"!==t)throw new Error(`Urbex expected a valid context to register a request api, but got ${t}.`);this.$api=new Y}else this.$api=new tt}async dispatchRequest(t){try{const e=t,r=await async function(t){const e=Date.now(),r=(new Date).toISOString(),n=m(R);if(!l(t.pipelines.request))try{await et.process(t,t.pipelines.request)}catch(e){const r=X.createFromError.call(V,e);return r.config=t,Promise.reject(r)}return async function(s){const i=g(n,{data:s.data,config:t,request:s.request||{},response:s.response||{},timestamp:r,responseType:t.responseType,cache:s.cache||{}});if(i.cache&&i.cache.hit){const t=200,e="Pulled from internal cache.";G.isNode?(i.response.statusCode=t,i.response.statusMessage=e):(i.response.status=t,i.response.statusText=e)}if(i.response)if(i.headers=i.response.headers,G.isNode)i.status=i.response.statusCode,i.statusText=i.response.statusMessage;else{const t=ct.parse(i.headers);i.headers=t,i.status=i.response.status,i.statusText=i.response.statusText}if(!l(t.pipelines.response))try{await et.process(i,t.pipelines.response)}catch(e){const r=X.createFromError.call(V,e);return r.config=t,r.request=i.request,r.response=i.response,r.status=i.status,Promise.reject(r)}const o=Date.now()-e;return i.duration=o,Promise.resolve(i)}}(e),n=e.cache&&e.cache.enabled;if(n){const t=this.$cache.getCacheKey(e.url.href),n=this.$cache.get(t,!0);if(n){const e=await r({data:n.v,request:null,response:null,cache:{key:t,pulled:!0,hit:!0,stored:!1}});return Promise.resolve(e)}}const s=await this.$api.send(e),i=await r(s);return n&&!o(i.data)&&(this.$cache.set(e.url.href,i.data),i.cache.key=this.$cache.getCacheKey(e.url.href),i.cache.stored=!0),i.cache.hit=n,Promise.resolve(i)}catch(t){if(X.isInstance(t))return Promise.reject(t);const e=X.createFromError.call(X,t);return e.message=t.message,Promise.reject(e)}}}const ut=["stream","raw"],at=new et((t=>(U.includes(d(t.method))?t.headers.set({"Content-Type":"application/x-www-form-urlencoded"}):t.data=void 0,Promise.resolve(t)))),ft=new et((async t=>{const{responseType:e,maxContentLength:r}=t.config;if(ut.includes(e)||t.cache.pulled)return Promise.resolve(t);const n=t.headers["content-encoding"];if(Buffer.isBuffer(t.data)&&t.data.length){if(n){const e=Z[n];if(e){const n=await e(t.data);if((r>-1||r!==1/0)&&n.length>r)throw new Error(`Content length of ${n.length} exceeds the maxContentLength of ${r}`);t.data=n}}}else t.data=null;return Promise.resolve(t)})),lt=new et((t=>{const{responseType:e,responseEncoding:r}=t.config;if(ut.includes(e)||"arraybuffer"===e||t.cache.pulled)return Promise.resolve(t);if(t.data){let n=t.data;G.isNode&&(n=t.data.toString(r)),t.data="json"===e?function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{return JSON.parse(t)}catch(r){return e?t:null}}(n,!0):n}return Promise.resolve(t)}));function dt(t,e){if(u(t))if(!(r=t).startsWith("//")&&r.startsWith("/")){if(!e)throw new Error("A valid URL string in the format of <scheme>://<hostname> must be passed when using `urbex.configure()`.");this.pathname=t}else this.parse(t);else void 0===t.origin&&(t.origin=""),t.href?this.parse(t.href):this.set(t).serialize(this.toJSON());var r}class pt{constructor(t){this.setup(),h(t)&&!l(t)&&this.set(this.createConfigurationObject(t,!0))}setup(){const t=G.getEnvironmentComponent(),e=m(S);e.request.push(at),e.response.push(lt),G.isNode&&e.response.unshift(ft);const r=g(m(j),{url:t,headers:new ct,pipelines:e});this.set(r)}defaultConfig(){return v(j,{url:G.getEnvironmentComponent(),headers:new ct})}createConfigurationObject(t,e){const r=this.parseIncomingConfig(t,e);return this.merge(r)}parseIncomingConfig(t,e){var r,n;if(y(t)||!h(t))throw new Error("The configuration must be an object with valid properties.");if(l(t))return{};const s=this.get(),o=w(t),c=w(s.url.toJSON()),f=new J;if(f.set(c),i(o,"url")){const t=o.url;if(!u(t)&&!h(t))throw new Error("The url property must be a string or an object.");dt.call(f,t,e)}if(i(o,"method")){const t=d(o.method);if(!q.includes(t))throw new Error(`The method ${t} is not a valid HTTP method.`);o.method=t}const p=parseInt(null===(r=o.timeout)||void 0===r?void 0:r.toString(),10);isNaN(p)&&(o.timeout=j.timeout);const m=parseInt(null===(n=o.maxContentLength)||void 0===n?void 0:n.toString(),10);isNaN(m)&&(o.maxContentLength=j.maxContentLength),a(t.resolveStatus)||(t.resolveStatus=j.resolveStatus);const g=ct.construct(o.headers,!0);return o.headers=null,o.url=null,v(o,{headers:g,url:f})}set(t){return this.$config=t,t}merge(t){var e,r,n,s;if(y(t)||!h(t)||l(t))return this.get();const i=this.get(),o=null!==(e=null===(r=t.headers)||void 0===r?void 0:r.get())&&void 0!==e?e:{},c=null!==(n=null===(s=t.url)||void 0===s?void 0:s.toJSON())&&void 0!==n?n:{},u=v(i.headers.get(),o),a=v(i.url.toJSON(),c),f=g(i,t),d=ct.construct(u),p=new J;return p.set(a),v(f,{headers:d,url:p})}get(){return this.$config}reset(){this.setup()}}function wt(t,e,r){if(y(e))throw new Error("Attempted to call a HTTP method without providing a URL. If you want to use the default URL, use `urbex.send` instead.");return v(r,{url:e,method:t})}class mt extends ht{constructor(t){super(),this.$config=new pt,h(t)&&!l(t)&&this.configure(t)}static create(t){return new mt(t)}get config(){return this.$config.get()}get cache(){return this.$cache}configure(t){const e=this.$config.createConfigurationObject(t,!1);this.$config.set(e);const r=this.$cache;function n(){r&&(r.clear(),r.isRunning&&r.stop())}l(e.cache)?n():(r.configure(e.cache),e.cache.enabled?r&&r.isRunning||r.start():!1===e.cache.enabled&&n())}send(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this.$config.parseIncomingConfig(t,!0),r=this.$config.merge(e);return this.dispatchRequest(r)}injectPipeline(){}ejectPipeline(){}subscribe(){}unsubscribe(){}reset(){this.$cache&&(this.$cache.clear(),this.$cache.isRunning&&this.$cache.stop()),this.$config.reset()}}function vt(t){return t instanceof mt}b(["delete","get","head","options"],((t,e)=>{mt.prototype[e]=function(t,r){return this.send(wt(d(e),t,r))}})),b(["post","put","patch"],((t,e)=>{mt.prototype[e]=function(t,r,n){const s=o(r)?r:h(n)?v(n,{data:r}):{data:r};return this.send(wt(d(e),t,s))}}));const gt=function(){const t=mt.create();return t.isolateClient=mt.create,t.environment=G,t.isUrbexClient=vt,t.Client=mt,t}();export{Q as NetworkError,V as PipelineError,et as PipelineExecutor,K as TimeoutError,J as URLParser,X as UrbexError,gt as default};
//# sourceMappingURL=urbex.min.js.map
